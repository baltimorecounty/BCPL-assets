<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for js\page-specific\search-results.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">js/page-specific/</a> search-results.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">27.27% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>18/66</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">4.17% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>1/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/0</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">30.51% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>18/59</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">namespacer('bcpl.pageSpecific');
&nbsp;
bcpl.pageSpecific.search = (($, Handlebars, querystringer) =&gt; {
	const getMaterialTypeData = (processMaterialTypeCallback) =&gt; {
<span class="cstat-no" title="statement not covered" >		$.ajax('/mockups/data/primaryMaterialType.json').then(json =&gt; <span class="cstat-no" title="statement not covered" >processMaterialTypeCallback(json),</span> err =&gt; <span class="cstat-no" title="statement not covered" >console.log(err))</span>;</span>
	};
&nbsp;
	const buildArrayFromRange = (start, end, current) =&gt;
<span class="cstat-no" title="statement not covered" >		Array.from({ length: (end - start) + 1 }, (value, key) =&gt;</span>
			(<span class="cstat-no" title="statement not covered" >{ page: (key + start), isCurrent: (key + start) === current })</span>);
&nbsp;
	const getPageNumbers = (current, max) =&gt; {
<span class="cstat-no" title="statement not covered" >		if (max &lt;= 1 || max &lt; current) <span class="cstat-no" title="statement not covered" >return 1;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		const difference = max - current;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		if (current &lt;= 3 &amp;&amp; max &lt;= 5) <span class="cstat-no" title="statement not covered" >return buildArrayFromRange(1, max, current);</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		if (current &lt;= 3 &amp;&amp; max &gt;= 5) <span class="cstat-no" title="statement not covered" >return buildArrayFromRange(1, 5, current);</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		if (difference &gt;= 2) <span class="cstat-no" title="statement not covered" >return buildArrayFromRange(current - 2, current + 2, current);</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		if (max &lt;= 5) <span class="cstat-no" title="statement not covered" >return buildArrayFromRange(1, max, current);</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		return buildArrayFromRange(max - 4, max, current);</span>
	};
&nbsp;
	const searchSuccessHandler = (data) =&gt; {
<span class="cstat-no" title="statement not covered" >		const templateData = data;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		if (templateData.SearchResults.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >			templateData.ResultsPerPageButtons = [</span>
				{ count: 10, isCurrent: data.ResultsPerPage === 10 },
				{ count: 25, isCurrent: data.ResultsPerPage === 25 },
				{ count: 50, isCurrent: data.ResultsPerPage === 50 },
				{ count: 100, isCurrent: data.ResultsPerPage === 100 }
			];
&nbsp;
<span class="cstat-no" title="statement not covered" >			templateData.PageNumbers = getPageNumbers(templateData.CurrentPage, templateData.Pages);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >			getMaterialTypeData((materialTypes) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >				const recordsWithIcons = [];</span>
<span class="cstat-no" title="statement not covered" >				_.map(templateData.SearchResults, (record) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >					const recordWithIcon = record;</span>
<span class="cstat-no" title="statement not covered" >					recordWithIcon.icon = materialTypes[_.findIndex(materialTypes, {</span>
						id: parseInt(record.PrimaryTypeOfMaterial, 10)
					})].icon;
<span class="cstat-no" title="statement not covered" >					recordsWithIcons.push(recordWithIcon);</span>
				});
&nbsp;
<span class="cstat-no" title="statement not covered" >				templateData.SearchResults = recordsWithIcons;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >				const source = $('#search-results-template').html();</span>
<span class="cstat-no" title="statement not covered" >				const template = Handlebars.compile(source);</span>
<span class="cstat-no" title="statement not covered" >				const html = template(templateData);</span>
<span class="cstat-no" title="statement not covered" >				$('.loading').hide();</span>
<span class="cstat-no" title="statement not covered" >				$('#search-results').html(html);</span>
			});
		} else {
<span class="cstat-no" title="statement not covered" >			$('.no-results').show();</span>
		}
	};
&nbsp;
	const searchErrorHandler = (err) =&gt; {
<span class="cstat-no" title="statement not covered" >		console.log(err);</span>
	};
&nbsp;
	const loadSearchPage = (searchTerm, pageNumber, selectedResultsPerPage) =&gt; {
<span class="cstat-no" title="statement not covered" >		window.location = `${window.location.pathname}?q=${searchTerm}&amp;page=${pageNumber}&amp;resultsPerPage=${selectedResultsPerPage}`;</span>
	};
&nbsp;
	const resultCountButtonClicked = (event) =&gt; {
<span class="cstat-no" title="statement not covered" >		const $button = $(event.currentTarget);</span>
<span class="cstat-no" title="statement not covered" >		const selectedResultsPerPage = $button.attr('data-results-per-page');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		loadSearchPage(event.data.searchTerm, event.data.pageNumber, selectedResultsPerPage);</span>
	};
&nbsp;
	const pageButtonClicked = (event) =&gt; {
<span class="cstat-no" title="statement not covered" >		const $button = $(event.currentTarget);</span>
<span class="cstat-no" title="statement not covered" >		const selectedPageNumber = $button.attr('data-page-number');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		loadSearchPage(event.data.searchTerm, selectedPageNumber, event.data.selectedResultsPerPage);</span>
	};
&nbsp;
	const init = () =&gt; {
		const querystring = querystringer.getAsDictionary();
&nbsp;
		<span class="missing-if-branch" title="if path not taken" >I</span>if (querystring.q) {
<span class="cstat-no" title="statement not covered" >			const searchTerm = querystring.q.trim();</span>
<span class="cstat-no" title="statement not covered" >			const pageNumber = querystring.page ? querystring.page : 1;</span>
<span class="cstat-no" title="statement not covered" >			const resultsPerPage = querystring.resultsperpage ? querystring.resultsperpage : 10;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >			$(document).on('click', '#pager .results-per-page button', { searchTerm, pageNumber, resultsPerPage }, resultCountButtonClicked);</span>
<span class="cstat-no" title="statement not covered" >			$(document).on('click', '#pager .page-numbers button', { searchTerm, pageNumber, resultsPerPage }, pageButtonClicked);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >			$.get(`${bcpl.constants.baseApiUrl}/api/polaris/search/${searchTerm}/${pageNumber}/${resultsPerPage}`).then(searchSuccessHandler, searchErrorHandler);</span>
		} else {
			$('.loading').hide();
			$('.no-results').show();
		}
	};
&nbsp;
	return {
		init
	};
})(jQuery, Handlebars, bcpl.utility.querystringer);
&nbsp;
$(() =&gt; {
	bcpl.pageSpecific.search.init();
});
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Sep 22 2017 15:59:21 GMT-0400 (Eastern Daylight Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
