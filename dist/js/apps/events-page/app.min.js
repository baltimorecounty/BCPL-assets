"use strict";!function(){var e=angular.module("sharedFilters",[]),t=function(e){var t=function(t){var a={};if(t){var n=e.search();delete n[t],a=n}e.search(a)},a=function(e,t){return!!t&&!!Object.keys(e).filter(function(e){return e.toLowerCase()===t.toLowerCase()}).length},n=function(e,t){return e?e&&e.indexOf(",")>-1?t?e:e.split(","):[e]:[]},r=function(){return e.search()},s=function(e,t,a){return Object.hasOwnProperty.call(e,t)?n(e[t],a):a?"":[]},i=function(t,a){if(t){var n=e.search();n[t]=a,e.search(n)}};return{clearQueryParams:t,doesKeyExist:a,getFiltersFromString:n,getQueryParams:r,getQueryParamValuesByKey:s,setQueryParams:i,updateQueryParams:function(e,n){var o=r();if(a(o,e)){var l=s(o,e),u=l.includes(n),c=[];if(u){var p=l.indexOf(n);l.splice(p,1)}else l.push(n);c=l,c.length?i(e,c.join(",")):t(e)}else i(e,n)}}};e.factory("sharedFilters.filterHelperService",["$location",t])}(),namespacer("bcpl"),bcpl.boostrapCollapseHelper=function(e){return{toggleCollapseById:function(t){e("#"+t).collapse("toggle")}}}(jQuery),function(){angular.module("eventsPageApp",["dataServices","events","sharedFilters","ngAria","ngRoute","ngSanitize"])}(),function(){var e=angular.module("events",[]),t={baseUrl:"https://testservices.bcpl.info",serviceUrls:{events:"/api/evanced/signup/events",eventRegistration:"/api/evanced/signup/registration"},remoteServiceUrls:{ageGroups:"https://bcpl.evanced.info/api/signup/agegroups",eventTypes:"https://bcpl.evanced.info/api/signup/eventtypes",locations:"https://bcpl.evanced.info/api/signup/locations"},templateUrls:{datePickersTemplate:"/_js/apps/events-page/templates/datePickers.html",eventsListTemplate:"/_js/apps/events-page/templates/eventsList.html",filtersTemplate:"/_js/apps/events-page/templates/filters.html",filtersExpandosTemplate:"/_js/apps/events-page/templates/filters-expandos.html",loadMoreTemplate:"/_js/apps/events-page/templates/loadMore.html",featuredEventsTemplate:"/_js/apps/events-page/templates/featuredEvents.html"},partialUrls:{eventListPartial:"/_js/apps/events-page/partials/eventList.html",eventDetailsPartial:"/_js/apps/events-page/partials/eventDetails.html",eventRegistrationPartial:"/_js/apps/events-page/partials/eventRegistration.html"},requestChunkSize:10};e.constant("events.CONSTANTS",t)}(),function(e){var t=function(e,t){e.when("/",{templateUrl:t.partialUrls.eventListPartial,controller:"EventsPageCtrl",controllerAs:"eventsPage",reloadOnSearch:!1}).when("/:id",{templateUrl:t.partialUrls.eventDetailsPartial,controller:"EventDetailsCtrl",controllerAs:"eventDetailsPage"}).when("/register/:id",{templateUrl:t.partialUrls.eventRegistrationPartial,controller:"EventRegistrationCtrl",controllerAs:"eventRegistrationPage"})};t.$inject=["$routeProvider","events.CONSTANTS"],e.config(t)}(angular.module("eventsPageApp")),function(e){var t=angular.module("dataServices",[]),a=function(t,a,n){var r=function(e,t){return new Date(e.EventStart).toLocaleDateString()===t},s=function(e){var t=[],a=void 0;return angular.forEach(e,function(n){var s=new Date(n.EventStart).toLocaleDateString();a!==s&&(t.push({date:new Date(n.EventStart),events:e.filter(function(e){return r(e,s)})}),a=s)}),t},i=function(e){return e.replace(":00","").replace(/\w\w$/,function(e){return e.split("").join(".")+"."})},o=function(t){var a=t,n=e(t.EventStart);return a.eventMonth=n.format("MMM"),a.eventDate=n.format("D"),a.eventTime=i(n.format("h:mm a")),a.requiresRegistration=0!==a.RegistrationTypeCodeEnum,a},l=function(e){return!e.isStarted&&e.requiresRegistration&&(!e.isFull||e.isFull&&e.isWaiting)},u=function(e){var t=[];return e.forEach(function(e){var a=o(e);t.push(a)}),t};return{get:function(e){return n(function(n,r){a.post(t.baseUrl+t.serviceUrls.events,e).then(function(e){e.data?n({eventGroups:s(e.data.Events),totalResults:e.data.TotalResults}):r(e)},r)})},getById:function(r){return n(function(n,s){a.get(t.baseUrl+t.serviceUrls.events+"/"+r).then(function(t){t.data?(t.data.Description&&(t.data.Description=t.data.Description.replace(/<[\w\/]+>/g,"")),t.data.isStarted=e(t.data.EventStart).isBefore(),t.data.isFull=0===t.data.MainSpotsAvailable,t.data.isWaiting=t.data.WaitSpotsAvailable>0,t.data.requiresRegistration=0!==t.data.RegistrationTypeCodeEnum,t.data.shouldDisplayRegistrationButton=l(t.data),n(t.data)):s(t)},s)})},getFeaturedEvents:function(e){return n(function(n,r){a.post(t.baseUrl+t.serviceUrls.events,e).then(function(e){e.data?n(u(e.data.Events)):r(e)},r)})}}};a.$inject=["events.CONSTANTS","$http","$q"],t.factory("dataServices.eventsService",a)}(window.moment),function(e){var t=function(e,t){return{request:function(a){return t(function(t,n){e.get(a).then(function(e){t(e.data)},function(e){n(e)})})}}};t.$inject=["$http","$q"],e.factory("metaService",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,a){return{register:function(n){return a(function(a,r){t.post(e.baseUrl+e.serviceUrls.eventRegistration,n).then(function(e){e.data?a({data:e.data}):r(e)},r)})}}};t.$inject=["events.CONSTANTS","$http","$q"],e.factory("registrationService",t)}(angular.module("eventsPageApp"));var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var t=function(){var e=function(e,t){var a="string"==typeof e?new Date(e):e;return"object"!==(void 0===a?"undefined":_typeof(a))||"Invalid Date"===a?a:(a.setDate(a.getDate()+t),a)},t=function(e,t,r){if(r)return"All Day";if(!e||isNaN(Date.parse(e)))return"Bad start date format";if("number"!=typeof t||t<=0)return"Bad event length format";var s=moment(e),i=moment(e).add(t,"m"),o=a(s),l=s.minute(),u=n(s),c=a(i),p=i.minute(),v=n(i);return o+(0===l?"":":"+l)+" "+(u===v?"":u)+" to "+c+(0===p?"":":"+p)+" "+v},a=function(e){var t=e.hour();return 0===t?12:t<=12?t:t-12},n=function(e){return e.hour()<12?"a.m.":"p.m."};return{addDays:e,formatSchedule:t}};e.factory("dateUtilityService",t)}(angular.module("eventsPageApp")),function(e){var t=function(){return{build:function(e){if(!e)return"";var t=Object.entries(e),a="";return t.length&&angular.forEach(t,function(e){a+=e[0]+"="+e[1]+"&"}),a}}};e.factory("querystringService",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,a,n,r,s){var i=this,o=a.id;i.data={},i.data.EventStartDate="",i.data.EventStartTime="",i.data.EventEndTime="",i.isLoading=!0,i.isError=!1,i.requestErrorMessage="Unfortunately, there was a problem loading this event's details. Please try again in a few minutes.";var l=function(e){i.data=e,i.data.EventStartDate=moment(i.data.EventStart).format("MMMM D, YYYY"),i.data.EventSchedule=s.formatSchedule(i.data.EventStart,i.data.EventLength,i.data.AllDay),i.isRegistrationRequired=0!==i.data.RegistrationTypeCodeEnum,i.isOver=moment().isAfter(moment(i.data.EventStart).add(i.data.EventLength,"m")),i.isLoading=!1},u=function(e){i.isLoading=!1,i.isError=!0};r.getById(o).then(l).catch(u)};t.$inject=["$scope","$timeout","$routeParams","events.CONSTANTS","dataServices.eventsService","dateUtilityService"],e.controller("EventDetailsCtrl",t)}(angular.module("eventsPageApp")),function(e,t){var a=function(e,a,n,r,s,i){var o=n.id,l=this;l.isGroup="false",l.isSubmitted=!1,l.isLoadingResults=!1,l.formConfirmationMessage=null,l.submitHandler=function(){l.isLoadingResults=!0;var e={EventId:parseInt(o,10),FirstName:l.firstName,LastName:l.lastName,Email:l.email,Phone:t("phoneNumber",l.phone,"xxx-xxx-xxxx"),IsGroup:"true"===l.isGroup,GroupCount:l.groupCount};s.register(e).then(function(e){var t=angular.element(".main-content").first().offset().top;l.postResult=e.data;var a=l.postResult.Data;if(a&&Object.prototype.hasOwnProperty.call(l.postResult.Data,"ConfirmationMessage")&&a.ConfirmationMessage.length)l.formConfirmationMessage=a.ConfirmationMessage;else{var n=l.postResult&&Object.prototype.hasOwnProperty.call(l.postResult,"Errors")&&l.postResult.Errors.length;l.formConfirmationMessage=n?l.postResult.Errors[0].Error:"Something went wrong, please try again later"}l.isSubmitted=!0,l.isLoadingResults=!1,angular.element("html, body").animate({scrollTop:t},250)})};var u=function(e){l.data=e,l.data.EventStartDate=moment(l.data.EventStart).format("MMMM D, YYYY"),l.data.EventSchedule=i.formatSchedule(l.data.EventStart,l.data.EventLength,l.data.AllDay)};r.getById(o).then(u)};a.$inject=["$window","$scope","$routeParams","dataServices.eventsService","registrationService","dateUtilityService"],e.controller("EventRegistrationCtrl",a)}(angular.module("eventsPageApp"),bcpl.utility.format),function(e,t){var a=function(e,a,n,r,s,i,o,l){var u=this,c=moment().format(),p=moment().add(30,"d"),v=p.format(),d={StartDate:c,EndDate:v,Page:1,IsOngoingVisible:!0,IsSpacesReservationVisible:!1,Limit:s.requestChunkSize,EventsTypes:[],AgeGroups:[],Locations:[]},f={zIndex:100,responsiveWidth:!0};u.eventGroups=[],u.keywords="",u.chunkSize=s.requestChunkSize,u.totalResults=0,u.isLastPage=!1,u.areDatesInvalid=!1,u.isLoading=!0,u.hasResults=!0,u.data={},u.locations=d.Locations,u.eventsTypes=d.EventsTypes,u.ageGroups=d.AgeGroups,u.keywordSearch=function(){d.Keyword=u.keywords,d.StartDate=c,d.Page=1,u.eventGroups=[],u.hasResults=!0,u.isLoading=!0,m("term",u.keywords),i.get(d).then(S).catch(h)};var m=function(e,t){t?o.setQueryParams(e,t):o.clearQueryParams(e)};u.filterByDate=function(){u.areDatesInvalid=!P(u.userStartDate,u.userEndDate),u.areDatesInvalid||(d.StartDate=u.userStartDate,d.EndDate=u.userEndDate,d.Page=1,u.eventGroups=[],u.hasResults=!0,u.isLoading=!0,u.requestErrorMessage="",m("startDate",u.userStartDate),m("endDate",u.userEndDate),i.get(d).then(S).catch(h))};var g=function(e,t){Object.prototype.hasOwnProperty.call(u.data,e)||(u.data[e]=t)};u.filterByTerms=function(e,t,a,n){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];switch(t.toLowerCase()){case"locations":y(d.Locations,e,a,t,n,r);break;case"agegroups":y(d.AgeGroups,e,a,t,n,r);break;case"eventtypes":y(d.EventsTypes,e,a,t,n,r)}u.eventGroups=[],u.hasResults=!0,u.isLoading=!0,i.get(d).then(S).catch(h)};var h=function(e){u.isLoading=!1,u.requestErrorMessage="There was a problem retrieving events. Please try again later."},y=function(e,t,a,n,r,s){if(a)e.push(t);else{var i=e.indexOf(t);-1!==i&&e.splice(i,1)}s&&o.updateQueryParams(n,r)};u.loadNextPage=function(){d.Page+=1,i.get(d).then(D).then(function(){a(function(){$(".event-date-bar").sticky(f)})})},u.clearFilters=function(){d.StartDate=c,d.EndDate=v,d.Page=1,d.Keyword="",d.AgeGroups=[],d.EventsTypes=[],d.Locations=[],u.keywords="",u.userStartDate="",u.userEndDate="",u.eventGroups=[],u.hasResults=!0,u.isLoading=!0,u.locations=d.Locations,u.eventsTypes=d.EventsTypes,u.ageGroups=d.AgeGroups,o.clearQueryParams(),i.get(d).then(S).catch(h)};var S=function(e){u.isLastPage=E(e.totalResults),u.eventGroups=e.eventGroups,u.isLoading=!1,u.hasResults=e.eventGroups.length,u.requestErrorMessage="",a(function(){$(".event-date-bar").sticky(f)})},D=function(e){u.isLastPage=E(e.totalResults),u.eventGroups=b(u.eventGroups,e.eventGroups)},E=function(e){return d.Page*u.chunkSize>=e},P=function(e,t){return!(!e||!t)&&moment(e).isSameOrBefore(t)},T=function(e,t){return!(!e||!t)&&moment(e).isSame(t,"day")},b=function(e,t){var a=e,n=a[a.length-1];return angular.forEach(t,function(e){T(n.date,e.date)?n.events=n.events.concat(e.events):a.push(e)}),a},w=function(e){angular.element(e.currentTarget).closest(".expando-wrapper").find("i").toggleClass("fa-plus-square").toggleClass("fa-minus-square")},C=function(){return r.search().term&&r.search().term.length?r.search().term:""};angular.element(document).on("hide.bs.collapse",".expando-wrapper .collapse",w),angular.element(document).on("show.bs.collapse",".expando-wrapper .collapse",w);var L=function(e,t){if(t){if(Object.prototype.hasOwnProperty.call(u.data,e)){var a=u.data[e].filter(function(e){return Object.prototype.hasOwnProperty.call(e,"Name")&&e.Name.toLowerCase().trim()===t.toLowerCase().trim()});return"locations"===e?a.length?a[0].LocationId:null:a.length?a[0].Id:null}}},A=function(){var e=o.getQueryParams();U(e),Object.keys(e).forEach(function(a){var n=a;if(!(n&&n.toLowerCase().indexOf("date")>-1)){var r=e[a];o.getFiltersFromString(r).forEach(function(e){var t=L(n,e);t&&u.filterByTerms(t,n,!0,e,!1)}),t.toggleCollapseById(n)}})},R=function(e){var t=["locations","eventTypes","ageGroups"],a=0;t.forEach(function(n,r){s.remoteServiceUrls[n]&&l.request(s.remoteServiceUrls[n]).then(function(r){g(n,r),a+=1,a===t.length&&e&&"function"==typeof e&&e()})})},U=function(e){var t=o.getQueryParamValuesByKey(e,"startDate",!0),a=o.getQueryParamValuesByKey(e,"endDate",!0);t&&a&&(u.userStartDate=t,u.userEndDate=a,u.filterByDate())};!function(){R(function(){A();var e=C();e?(u.keywords=e,u.keywordSearch()):i.get(d).then(S).catch(h)})}()};a.$inject=["$scope","$timeout","$animate","$location","events.CONSTANTS","dataServices.eventsService","sharedFilters.filterHelperService","metaService"],e.controller("EventsPageCtrl",a)}(angular.module("eventsPageApp"),bcpl.boostrapCollapseHelper),function(e){var t=function(e,t){return{link:function(t,a,n){var r=t;r.areDatesInvalid=!1;var s={dateFormat:"F d, Y",disable:[function(e){return moment(e).isBefore(new Date,"day")}],onChange:function(){e(function(){r.userStartDate=r.userStartDate||r.userEndDate,r.userEndDate=r.userEndDate||r.userStartDate,e(function(){moment(r.userStartDate).isSameOrBefore(r.userEndDate)?(r.areDatesInvalid=!1,r.filterByDate()):r.areDatesInvalid=!0})})}};r.openFlatpickr=function(e){document.querySelector("#"+e)._flatpickr.open()},flatpickr("#start-date, #end-date",s)},restrict:"E",templateUrl:t.templateUrls.datePickersTemplate,scope:{userStartDate:"=startDateModel",userEndDate:"=endDateModel",filterByDate:"=filterByDate"}}};t.$inject=["$timeout","events.CONSTANTS"],e.directive("datePickers",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,a){var n=function(e){var t=e,n={weekday:"long",year:"numeric",month:"long",day:"numeric"};t.eventScheduleString=function(e){return a.formatSchedule(e.EventStart,e.EventLength,e.AllDay)},t.getDisplayDate=function(e){return e.date.toLocaleDateString("en-US",n)}};return{restrict:"E",templateUrl:t.templateUrls.eventsListTemplate,link:n,scope:{eventGroups:"="}}};t.$inject=["$timeout","events.CONSTANTS","dateUtilityService"],e.directive("eventsList",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{link:function(e){var t=e;t.search=function(e,a,n){var r=e.item.Id||e.item.LocationId,s=e.item.Name||e.item.Id;t.searchFunction(r,a,n,s,t.items)},t.removeDisallowedCharacters=function(e){var t=/[^A-Za-z0-9-_.]/g;return e.trim().replace(t,"-")},t.isFilterChecked=function(e,a){var n=e&&"locations"===e?a.LocationId:a.Id;return!!t.activeFilters&&t.activeFilters.includes(n)}},restrict:"E",scope:{filterType:"@",choiceType:"@",searchFunction:"=",items:"=",activeFilters:"="},templateUrl:t.templateUrls.filtersExpandosTemplate}};t.$inject=["metaService","events.CONSTANTS"],e.directive("filtersExpandos",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{link:function(e){var t=e;t.search=function(e,a,n){var r=e.item.Id||e.item.LocationId;t.searchFunction(r,a,n)},t.removeDisallowedCharacters=function(e){var t=/[^A-Za-z0-9-_.]/g;return e.trim().replace(t,"-")},t.isFilterChecked=function(e,a){var n=e&&"locations"===e?a.LocationId:a.Id;return t.activeFilters.includes(n)}},restrict:"E",scope:{filterType:"@",choiceType:"@",searchFunction:"=",activeFilters:"="},templateUrl:t.templateUrls.filtersTemplate}};t.$inject=["metaService","events.CONSTANTS"],e.directive("filters",t)}(angular.module("eventsPageApp")),function(e){var t=function(e){return{restrict:"E",templateUrl:e.templateUrls.loadMoreTemplate,scope:{loadNextPage:"=",chunkSize:"="}}};t.$inject=["events.CONSTANTS"],e.directive("loadMore",t)}(angular.module("eventsPageApp"));