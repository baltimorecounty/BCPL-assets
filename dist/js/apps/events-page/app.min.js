"use strict";!function(){var e=angular.module("sharedFilters",[]),t=function(e){var t=function(e,t){var a=Object.assign({},t);return e&&delete a[e],a},a=function(a){if(!a)return void e.search({});var n=Object.assign({},e.search());a.forEach(function(e){n=t(e,n)}),e.search(n)},n=function(e,t){return!!t&&!!Object.keys(e).filter(function(e){return e.toLowerCase()===t.toLowerCase()}).length},r=function(e,t){return e?e.indexOf(",")>-1?t?e:e.split(","):[e]:[]},i=function(){return e.search()},o=function(e,t,a){return Object.hasOwnProperty.call(e,t)?r(e[t],a):a?"":[]},s=function(t){t.forEach(function(t){var a=t.key,n=t.val;if(a){var r=e.search();r[a]=n,e.search(r)}})};return{clearQueryParams:a,doesKeyExist:n,getFiltersFromString:r,getQueryParams:i,getQueryParamValuesByKey:o,setQueryParams:s,updateQueryParams:function(e){var t=i();e.forEach(function(e){var r=e.key,i=e.val;if(n(t,r)){var l=o(t,r),u=l.includes(i),c=[];if(u){var d=l.indexOf(i);l.splice(d,1)}else l.push(i);c=l,c.length?s([{key:r,val:c.join(",")}]):a([r])}else s([{key:r,val:i}])})}}};e.factory("sharedFilters.filterHelperService",["$location",t])}(),namespacer("bcpl"),bcpl.boostrapCollapseHelper=function(e){return{toggleCollapseByIds:function(t){var a=t.activePanels,n=t.inActivePanels;a.forEach(function(t){e("#"+t).collapse("show")}),n.forEach(function(t){e("#"+t).collapse("hide")})}}}(jQuery),function(){angular.module("eventsPageApp",["dataServices","events","sharedFilters","ngAria","ngRoute","ngSanitize"])}(),function(){var e=angular.module("events",[]),t={baseUrl:"https://services.bcpl.info",serviceUrls:{events:"/api/evanced/signup/events",eventRegistration:"/api/evanced/signup/registration",eventTypes:"/api/evanced/signup/eventtypes",downloads:"/api/evanced/signup/download"},remoteServiceUrls:{ageGroups:"https://bcpl.evanced.info/api/signup/agegroups",locations:"https://bcpl.evanced.info/api/signup/locations"},templateUrls:{datePickersTemplate:"/_js/apps/events-page/templates/datePickers.html",eventsListTemplate:"/_js/apps/events-page/templates/eventsList.html",filtersTemplate:"/_js/apps/events-page/templates/filters.html",filtersExpandosTemplate:"/_js/apps/events-page/templates/filters-expandos.html",loadMoreTemplate:"/_js/apps/events-page/templates/loadMore.html",featuredEventsTemplate:"/_js/apps/events-page/templates/featuredEvents.html"},partialUrls:{eventListPartial:"/_js/apps/events-page/partials/eventList.html",eventDetailsPartial:"/_js/apps/events-page/partials/eventDetails.html",eventRegistrationPartial:"/_js/apps/events-page/partials/eventRegistration.html"},requestChunkSize:10,ageDisclaimer:{message:"Children under 8 must be accompanied by an adult",ageGroupIds:[9,10,11,12,13]},eventDetailsError:{message:"There was a problem loading this event's details. Please select a different event."},dateOffsets:{registrationStart:{numberOfUnits:7,unit:"days"},registrationEnd:{numberOfUnits:0,unit:"days"}},analytics:{bcplEventsCategory:"BCPL Events"}};e.constant("events.CONSTANTS",t)}(),function(e){var t=function(e,t,a){t.when("/",{templateUrl:a.partialUrls.eventListPartial,controller:"EventsPageCtrl",controllerAs:"eventsPage",reloadOnSearch:!1}).when("/:id",{templateUrl:a.partialUrls.eventDetailsPartial,controller:"EventDetailsCtrl",controllerAs:"eventDetailsPage"}).when("/register/:id",{templateUrl:a.partialUrls.eventRegistrationPartial,controller:"EventRegistrationCtrl",controllerAs:"eventRegistrationPage"})},a=function(e,t){var a=t.absUrl();if(-1===a.indexOf("#!")&&a.indexOf("?")>-1){var n=bcpl.utility.querystringer.getAsDictionary().eventid;e.location=n?"/events-and-programs/list.html#!/"+n:"/events-and-programs/list.html#!/"+e.location.search}};t.$inject=["$locationProvider","$routeProvider","events.CONSTANTS"],a.$inject=["$window","$location"],e.config(t).run(a)}(angular.module("eventsPageApp")),function(e){function t(e){return e.flatpickr,e.flatpickr}t.$inject=["$window"],e.factory("flatpickr",t)}(angular.module("eventsPageApp")),function(e){var t=angular.module("dataServices",[]),a=function(t,a,n){var r=function(e,t){return new Date(e.EventStart).toLocaleDateString()===t},i=function(t){var a=[],n=void 0;return angular.forEach(t,function(i){var o=i.EventStart?i:f(i,e()),s=new Date(o.EventStart).toLocaleDateString();if(n!==s){var l=o.EventStart||o.OnGoingStartDate,u=t.filter(function(e){return r(e,s)});a.push({date:new Date(l),events:u}),n=s}}),a},o=function(t,a){return e(t.date).isSame(a.date,"day")?0:e(t.date).isBefore(a.date)?-1:1},s=function(e){return n(function(n,r){a.post(t.baseUrl+t.serviceUrls.events,e).then(function(e){if(e.data){var t=i(e.data.Events),a=t.sort(o);n({eventGroups:a,totalResults:e.data.TotalResults,hasMoreResults:e.data.HasMoreResults})}else r(e)},r)})},l=function(r){return n(function(n,i){a.get(t.baseUrl+t.serviceUrls.events+"/"+r).then(function(a){if(a.data){a.data.Description&&(a.data.Description=a.data.Description.replace(/<[\w\/]+>/g,""));var r=t.dateOffsets,o=r.registrationStart,s=r.registrationEnd;a.data.registrationStarts=e(a.data.EventStart).subtract(o.numberOfUnits,o.unit),a.data.registrationEnds=e(a.data.EventStart).subtract(s.numberOfUnits,s.unit),a.data.registrationStartsDisplay=u(a.data.registrationStarts.format("M/D/YYYY @ h:mm a")),a.data.registrationEndsDisplay=u(a.data.registrationEnds.format("M/D/YYYY @ h:mm a")),a.data.onGoingStartDate=e(a.data.OnGoingStartDate).format("M/D/YYYY"),a.data.onGoingEndDate=e(a.data.OnGoingEndDate).format("M/D/YYYY"),a.data.isStarted=e(a.data.EventStart).isBefore(),a.data.isRegistrationClosed=a.data.registrationEnds.isBefore(),a.data.isRegistrationWindow=e().isBetween(a.data.registrationStarts,a.data.registrationEnds),a.data.isFull=1===a.data.RegistrationTypeCodeEnum&&0===a.data.MainSpotsAvailable,a.data.isWaiting=a.data.WaitSpotsAvailable>0,a.data.requiresRegistration=0!==a.data.RegistrationTypeCodeEnum,a.data.shouldDisplayRegistrationButton=d(a.data),n(a.data)}else i(a)},i)})},u=function(e){return e.replace(":00","").replace(/\w\w$/,function(e){return e.split("").join(".")+"."})},c=function(t){var a=t,n=e(t.EventStart);return a.eventMonth=n.format("MMM"),a.eventDate=n.format("D"),a.eventTime=u(n.format("h:mm a")),a.requiresRegistration=0!==a.RegistrationTypeCodeEnum,a},d=function(e){return!e.isStarted&&e.isRegistrationWindow&&e.requiresRegistration&&(!e.isFull||e.isFull&&e.isWaiting)},v=function(e){var t=[];return e.forEach(function(e){var a=c(e);t.push(a)}),t},f=function(t,a){var n=e(t.OnGoingStartDate),r=e(n).isSame(a,"day"),i=t,o=n.isAfter(a);return i.EventStart=(o||r)&&t.OnGoingStartDate,i.EventStart||(i.EventStart=a),i};return{get:s,getById:l,getFeaturedEvents:function(e){return n(function(n,r){a.post(t.baseUrl+t.serviceUrls.events,e).then(function(e){e.data?n(v(e.data.Events)):r(e)},r)})}}};a.$inject=["events.CONSTANTS","$http","$q"],t.factory("dataServices.eventsService",a)}(window.moment),function(e){var t=function(e,t){return{request:function(a){return t(function(t,n){e.get(a).then(function(e){t(e.data)},function(e){n(e)})})}}};t.$inject=["$http","$q"],e.factory("metaService",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,a){return{register:function(n){return a(function(a,r){t.post(e.baseUrl+e.serviceUrls.eventRegistration,n).then(function(e){e.data?a({data:e.data}):r(e)},r)})}}};t.$inject=["events.CONSTANTS","$http","$q"],e.factory("registrationService",t)}(angular.module("eventsPageApp")),function(e,t){var a=function(e){var t=function(t){e.addthis.update("share","url",t)},a=function(t){e.addthis.update("share","title",t)};return{update:function(n,r){e.addthis&&(t(n),a(r))}}};a.$inject=["$window"],e.factory("addthisService",a)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{shouldShowDisclaimer:function(a){var n=t.ageDisclaimer.ageGroupIds,r=a.AgeGroups,i=e._.intersection(n,r);return i&&i.length>0}}};t.$inject=["$window","events.CONSTANTS"],e.factory("ageDisclaimerService",t)}(angular.module("eventsPageApp"));var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var t=function(){var e=function(e,t){var a="string"==typeof e?new Date(e):e;return"object"!==(void 0===a?"undefined":_typeof(a))?a:(a.setDate(a.getDate()+t),a)},t=function(e,t,r){var i=e.EventStart||null,o=e.OnGoingStartDate,s=e.OnGoingEndDate;if(r)return"All Day";if(!i&&!o&&!s||i&&isNaN(Date.parse(i)))return"Bad start date format";if(i&&("number"!=typeof t||t<0))return"Bad event length format";if(o&&s){return moment(o).format("M/D")+" to "+moment(s).format("M/D")}var l=moment(i),u=moment(i).add(t,"m"),c=a(l),d=l.minute(),v=n(l),f=a(u),p=u.minute(),m=n(u);return c+(0===d?"":":"+d)+" "+(v===m?"":v)+" to "+f+(0===p?"":":"+p)+" "+m},a=function(e){var t=e.hour();return 0===t?12:t<=12?t:t-12},n=function(e){return e.hour()<12?"a.m.":"p.m."};return{addDays:e,formatSchedule:t}};e.factory("dateUtilityService",t)}(angular.module("eventsPageApp")),function(e,t){var a=function(e){var a=function(e){var a=e.eventTitle,n=e.eventDescription,r=e.eventLocation,i=e.eventStartDate,o=e.eventEndDate,s=new t;return s.addEvent(a,n,r,i,o),s},n=function(e){var t=i(e);a(t).download(t.eventTitle)},r=function(e){var t=e.split(" ");if(2===t.length){var a=t[0].trim(),n=t[1].trim();return(a.indexOf(":")>-1?a+":00":a+":00:00")+" "+n}return e},i=function(e){var t=e.Description,a=e.LocationName,n=e.Title,r="Baltimore County Public Library, "+a+" Branch - "+n,i=a+" Branch",o=u(e);return{eventTitle:r,eventDescription:t,eventLocation:i,eventStartDate:o.eventStartDate,eventEndDate:o.eventEndDate}},o=function(t,a){var n=a.AllDay,r=a.EventSchedule,i=a.EventStart,o=a.OnGoingEndDate,l=e.moment(t).format("MM/DD/YYYY"),u=s(r,n),c=i?l+" "+u:o;return e.moment(c).format("MM/DD/YYYY h:mm:ss a")},s=function(e,t){if(t)return"11:59:59 PM";var a=e.split("to");return 2===a.length?r(a[1].trim().replace(/\./g,"")):null},l=function(t){var a=t.EventStart,n=t.OnGoingStartDate,r=a||n;return e.moment(r).format("MM/DD/YYYY h:mm:ss a")},u=function(e){var t=l(e);return{eventStartDate:t,eventEndDate:o(t,e)}};return{createEvent:a,downloadCalendarEvent:n,getCalendarParts:i,getEndDate:o,getEndTime:s,getStartDate:l,getEventDates:u,formatTime:r}};a.$inject=["$window"],e.factory("downloadCalendarEventService",a)}(angular.module("eventsPageApp"),window.ics),function(e){var t=function(){var e=function(e){return e.replace("!","%21").replace("#","%23")},t=function(t){return"Check out this event at the Baltimore County Public Library: "+e(t)},a=function(e){return e.EventStartDate+" - "+e.Title};return{cleanUrl:e,getEmailBody:t,getEmailSubject:a,getShareUrl:function(e,n){var r=t(n);return"mailto:?subject="+a(e)+"&body="+r}}};e.factory("emailUtilityService",t)}(angular.module("eventsPageApp")),function(e){var t=function(){return{build:function(e){if(!e)return"";var t=Object.entries(e),a="";return t.length&&angular.forEach(t,function(e){a+=e[0]+"="+e[1]+"&"}),a}}};e.factory("querystringService",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return function(a){var n=a||{},r=e.moment().format(),i=e.moment().add(30,"d").format();return{StartDate:n.StartDate||r,EndDate:n.EndDate||i,Page:n.Page||1,IsOngoingVisible:n.IsOngoingVisible||!0,IsSpacesReservationVisible:n.IsSpacesReservationVisible||!1,Limit:n.limit||t.requestChunkSize,EventsTypes:n.eventTypes||[],AgeGroups:n.AgeGroups||[],Locations:n.locations||[],Keyword:n.Keyword||""}}};t.$inject=["$window","events.CONSTANTS"],e.factory("RequestModel",t)}(angular.module("eventsPageApp")),function(e,t){var a=function(e,t,a,n,r,i,o,s,l,u,c){t.scrollTo(0,0);var d=this,v=n.id;d.data={},d.data.EventStartDate="",d.data.EventStartTime="",d.data.EventEndTime="",d.isLoading=!0,d.isError=!1,d.requestErrorMessage=r.eventDetailsError.message;var f=function(e){if(Object.prototype.hasOwnProperty.call(e,"EventId")&&!e.EventId)return void p();d.data=e,d.data.EventStartDate=t.moment(d.data.EventStart).format("MMMM D, YYYY"),d.data.EventSchedule=o.formatSchedule(d.data,d.data.EventLength,d.data.AllDay),d.isRegistrationRequired=0!==d.data.RegistrationTypeCodeEnum;var a=d.data.EventStart||d.data.OnGoingStartDate;d.eventDayOfWeek=t.moment(a).format("dddd"),d.onGoingEventEndDayOfWeek=d.data.OnGoingEndDate&&t.moment(d.data.OnGoingEndDate).format("dddd"),d.isOver=d.data.EventStart?t.moment().isAfter(t.moment(a).add(d.data.EventLength,"m")):t.moment().startOf("day").isAfter(t.moment(a).endOf("day")),d.isLoading=!1,d.shareUrl=s.getShareUrl(d.data,t.location.href),d.shouldShowDisclaimer=u.shouldShowDisclaimer(d.data),d.disclaimer=r.ageDisclaimer.message,d.downloadUrl=""+r.baseUrl+r.serviceUrls.downloads+"/"+v,c.update(t.location.href,d.data.LocationName+" - "+d.data.Title)},p=function(){d.isLoading=!1,d.isError=!0};i.getById(v).then(f).catch(p)};a.$inject=["$scope","$window","$timeout","$routeParams","events.CONSTANTS","dataServices.eventsService","dateUtilityService","emailUtilityService","downloadCalendarEventService","ageDisclaimerService","addthisService"],e.controller("EventDetailsCtrl",a)}(angular.module("eventsPageApp"),window.ics),function(e,t){var a=function(e,a,n,r,i,o,s,l,u,c,d){e.scrollTo(0,0);var v=n.id,f=this;f.showGroups=!1,f.isGroup="false",f.isSubmitted=!1,f.isLoadingResults=!1,f.formConfirmationMessage=null,f.downloadUrl=""+r.baseUrl+r.serviceUrls.downloads+"/"+v;var p=function(e){return e&&Object.prototype.hasOwnProperty.call(e,"ConfirmationMessage")&&e.ConfirmationMessage&&e.ConfirmationMessage.length};f.isFieldValid=function(e,t){return(e[t].$touched||e.$submitted)&&e[t].$invalid},f.submitHandler=function(e,a){if(!a.$valid)return void(f.isLoadingResults=!1);var n={EventId:parseInt(v,10),FirstName:f.firstName,LastName:f.lastName,Email:f.email,Phone:t("phoneNumber",f.phone,"xxx-xxx-xxxx"),IsGroup:"true"===f.isGroup,GroupCount:f.groupCount};o.register(n).then(function(e){var t=angular.element(".main-content").first().offset().top;f.postResult=e.data;var a=f.postResult.Data;if(p(a))f.formConfirmationMessage=a.ConfirmationMessage;else{var n=f.postResult&&Object.prototype.hasOwnProperty.call(f.postResult,"Errors")&&f.postResult.Errors.length;f.formConfirmationMessage=n?f.postResult.Errors[0].Error:"Something went wrong, please try again later"}f.isSubmitted=!0,f.isLoadingResults=!1,angular.element("html, body").animate({scrollTop:t},250)})};var m=function(t){f.data=t,f.data.EventStartDate=e.moment(f.data.EventStart).format("MMMM D, YYYY"),f.data.EventSchedule=s.formatSchedule(f.data,f.data.EventLength,f.data.AllDay),f.shareUrl=l.getShareUrl(f.data,e.location.href),f.shouldShowDisclaimer=c.shouldShowDisclaimer(f.data),f.disclaimer=r.ageDisclaimer.message,f.downloadUrl=""+r.baseUrl+r.serviceUrls.downloads+"/"+v,d.update(e.location.href,f.data.LocationName+" - "+f.data.Title)};i.getById(v).then(m)};a.$inject=["$window","$scope","$routeParams","events.CONSTANTS","dataServices.eventsService","registrationService","dateUtilityService","emailUtilityService","downloadCalendarEventService","ageDisclaimerService","addthisService"],e.controller("EventRegistrationCtrl",a)}(angular.module("eventsPageApp"),bcpl.utility.format),function(e,t,a,n,r,i,o){var s=function(e,s,l,u,c,d,v,f,p,m,g,h,y){var S=i.trackEvent;setTimeout(function(){d.scrollTo(0,0)},500);var D=this,E=["locations","eventTypes","ageGroups"],w=function(){return d.moment().format()},b=function(){return d.moment().add(30,"d").format()};D.requestModel=new g;var P={zIndex:100,responsiveWidth:!0};D.eventGroups=[],D.keywords="",D.chunkSize=v.requestChunkSize,D.totalResults=0,D.isLastPage=!1,D.areDatesInvalid=!1,D.isLoading=!0,D.hasResults=!0,D.data={},D.locations=[],D.eventsTypes=[],D.ageGroups=[],D.isMobile=!1;var T=function(){D.isMobile=d.innerWidth<=r.breakpoints.medium,D.filterCollapseUrl=D.isMobile?"#events-search-wrapper":"",D.isMobile&&(D.isFilterCollapseExpanded=!1),s.$$phase||s.$digest()};D.toggleFilterCollapse=function(){D.isFilterCollapseExpanded=!D.isFilterCollapseExpanded},T(),a(T);var O=function(e){var t=[],a=[];return e.Locations.length?t.push("locations"):a.push("locations"),e.EventsTypes.length?t.push("eventTypes"):a.push("eventTypes"),e.AgeGroups.length?t.push("ageGroups"):a.push("ageGroups"),{activePanels:t,inActivePanels:a}};D.filterEvents=function(e,a,r){D.eventGroups=[],D.isLoading=!0,D.hasResults=!0,D.requestErrorMessage="",D.requestModel=e,o("#start-date, #end-date",function(){var t=angular.element("#start-date")[0]._flatpickr,a=angular.element("#end-date")[0]._flatpickr;t&&t.setDate(d.moment(e.StartDate).toDate()),a&&a.setDate(d.moment(e.EndDate).toDate()),D.userStartDate=d.moment(e.StartDate).format("MMMM DD, YYYY"),D.userEndDate=d.moment(e.EndDate).format("MMMM DD, YYYY")}),f.get(e).then(function(i){R(i),D.hasResults=!!C(i);var o=O(e);a?t.toggleCollapseByIds(o):n.cycleWithMessage("Event list updated!"),r&&"function"==typeof r&&r(i)}).catch(U)};var C=function(e){return e&&Object.prototype.hasOwnProperty.call(e,"totalResults")?e.totalResults:0};D.keywordSearch=function(){var e=Object.assign({},D.requestModel);e.Keyword=D.keywords,e.Page=1,p.setQueryParams([{key:"term",val:D.keywords}]),S({action:"Keyword Search",category:v.analytics.bcplEventsCategory,label:D.keywords})},D.filterByDate=function(){if(D.areDatesInvalid=!N(D.userStartDate,D.userEndDate),!D.areDatesInvalid){var e=Object.assign({},D.requestModel);e.StartDate=D.userStartDate,e.EndDate=D.userEndDate,e.Page=1,p.setQueryParams([{key:"startDate",val:D.userStartDate},{key:"endDate",val:D.userEndDate}]),S({action:"Date Filter Selection",category:v.analytics.bcplEventsCategory,label:D.userStartDate+" - "+D.userEndDate})}},D.clearFilters=function(){k(),j(),p.clearQueryParams(),D.filterEvents(D.requestModel),S({action:"Clear All Filters",category:v.analytics.bcplEventsCategory})},D.loadNextPage=function(){var e=Object.assign({},D.requestModel);e.Page+=1,D.requestModel=e,f.get(e).then(L).then(function(){l(function(){$(".event-date-bar").sticky(P)})})};var M=function(e,t){Object.prototype.hasOwnProperty.call(D.data,e)||(D.data[e]=t)};D.filterByTerms=function(e,t,a,n){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=Object.assign({},D.requestModel);switch(t.toLowerCase()){case"locations":A(i.Locations,e,a,t,n,r);break;case"agegroups":A(i.AgeGroups,e,a,t,n,r);break;case"eventtypes":A(i.EventsTypes,e,a,t,n,r)}D.filterEvents(i)};var U=function(){D.isLoading=!1,D.requestErrorMessage="There was a problem retrieving events. Please try again later."},A=function(e,t,a,n,r,i){if(a)e.push(t);else{var o=e.indexOf(t);-1!==o&&e.splice(o,1)}i&&p.updateQueryParams([{key:n,val:r}])},k=function(){D.requestModel=new g},j=function(){D.keywords="",D.userStartDate="",D.userEndDate=""},R=function(e){D.isLastPage=Y(e.totalResults),D.isLoading=!1,D.eventGroups=e.eventGroups,D.hasResults=e.eventGroups.length,D.requestErrorMessage="",D.hasMoreResults=e.hasMoreResults,l(function(){$(".event-date-bar").sticky(P)})},L=function(e){D.hasMoreResults=e.hasMoreResults,D.isLastPage=Y(e.totalResults),D.eventGroups=F(D.eventGroups,e.eventGroups)},Y=function(e){return D.requestModel.Page*D.chunkSize>=e},N=function(e,t){return!(!e||!t)&&d.moment(e).isSameOrBefore(t)},G=function(e,t){return!(!e||!t)&&d.moment(e).isSame(t,"day")},F=function(e,t){var a=e,n=a[a.length-1];return angular.forEach(t,function(e){G(n.date,e.date)?n.events=n.events.concat(e.events):a.push(e)}),a},q=function(e){angular.element(e.currentTarget).closest(".expando-wrapper").find("i").toggleClass("fa-plus-square").toggleClass("fa-minus-square")},I=function(){return c.search().term&&c.search().term.length?c.search().term:""};angular.element(document).on("hide.bs.collapse",".expando-wrapper .collapse",q),angular.element(document).on("show.bs.collapse",".expando-wrapper .collapse",q);var x=function(e,t){if(!t)return-1;if(Object.prototype.hasOwnProperty.call(D.data,e)){var a=D.data[e].filter(function(e){return Object.prototype.hasOwnProperty.call(e,"Name")&&e.Name.toLowerCase().trim()===t.toLowerCase().trim()});return"locations"===e?a.length?a[0].LocationId:null:a.length?a[0].Id:null}return-1},B=function(e){return 0===Object.keys(e).length&&e.constructor===Object},_=function(e){return e&&e.toLowerCase().indexOf("date")>-1},Q=function(e){return e.replace(/^\w/,function(e){return e.toUpperCase()})},z=function(){var e=Object.assign({},D.requestModel),t=p.getQueryParams();if(B(t))return j(),D.requestModel;var a=I();e.Keyword=a,D.keywords=a;var n=Z(t);return n&&(e.StartDate=n.startDate,e.EndDate=n.endDate),Object.keys(t).forEach(function(a){if(!_(a)){var n=t[a];p.getFiltersFromString(n).forEach(function(t){var n=x(a,t);if(n&&n>-1){var r=Q(a);r.indexOf("EventTypes")>-1&&(r="EventsTypes"),e[r]=W(e[r],n)}})}}),e},W=function(e,t){var a=e?e.slice():[];return e&&e.length&&e.includes(t)?a=e.filter(function(e){return e!==t}):a.push(t),a},K=function(e,t,a){M(t,e),a&&"function"==typeof a&&a()},V=function(e,t){t&&"function"==typeof t&&t(e)},H=function(e,t){var a=void 0,n=0;E.forEach(function(r){v.remoteServiceUrls[r]?a=v.remoteServiceUrls[r]:v.serviceUrls[r]&&(a=""+v.baseUrl+v.serviceUrls[r]),m.request(a).then(function(t){return K(t,r,function(){(n+=1)===E.length&&e()})},function(e){return V(e,t)})})},Z=function(e){var t=p.getQueryParamValuesByKey(e,"startDate",!0),a=p.getQueryParamValuesByKey(e,"endDate",!0);return t||a?(D.userStartDate=t,D.userEndDate=a,{startDate:t||w(),endDate:a||b()}):null},J=function(e){var t=z();D.filterEvents(t,e)},X=function(){return f.get(D.requestModel).then(R).catch(U)},ee=function(){H(function(){J(!0)},X),h.update(d.location.href,e.title)},te=function(e){return/(?!.*\?.*$)(^.*\/\d{6,}$)/g.test(e)};s.$on("$locationChangeSuccess",function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];var n=t&&t.length>=2?t[1]:"";te(n)||(k(),J())}),$(function(){ee()})};s.$inject=["$document","$scope","$timeout","$animate","$location","$window","events.CONSTANTS","dataServices.eventsService","sharedFilters.filterHelperService","metaService","RequestModel","addthisService","flatpickr"],e.controller("EventsPageCtrl",s)}(angular.module("eventsPageApp"),bcpl.boostrapCollapseHelper,bcpl.utility.windowResize,bcpl.utility.windowShade,bcpl.constants,bcpl.utility.googleAnalytics,bcpl.utility.waitForExistence),function(e){var t=function(e,t,a){return{link:function(a,n,r){var i=a,o=function(){return t.moment().format()},s=function(){return t.moment().add(30,"d").format()};i.areDatesInvalid=!1;var l={dateFormat:"F d, Y",disable:[function(e){return t.moment(e).isBefore(new Date,"day")}],onChange:function(){e(function(){i.userStartDate=i.userStartDate||o(),i.userEndDate=i.userEndDate||s(),e(function(){t.moment(i.userStartDate).isSameOrBefore(i.userEndDate)?(i.areDatesInvalid=!1,i.filterByDate()):i.areDatesInvalid=!0})})}};i.openFlatpickr=function(e){document.querySelector("#"+e)._flatpickr.open()},angular.element(document).ready(function(){t.flatpickr("#start-date, #end-date",l)})},restrict:"E",templateUrl:a.templateUrls.datePickersTemplate,scope:{userStartDate:"=startDateModel",userEndDate:"=endDateModel",filterByDate:"=filterByDate"}}};t.$inject=["$timeout","$window","events.CONSTANTS"],e.directive("datePickers",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,a,n){var r=function(e){var r=e,i={weekday:"long",year:"numeric",month:"long",day:"numeric"};r.eventScheduleString=function(e){return a.formatSchedule(e,e.EventLength,e.AllDay)},r.getDisplayDate=function(e){return e.date.toLocaleDateString("en-US",i)},r.shouldShowDisclaimer=n.shouldShowDisclaimer,r.disclaimer=t.ageDisclaimer.message};return{restrict:"E",templateUrl:t.templateUrls.eventsListTemplate,link:r,scope:{eventGroups:"="}}};t.$inject=["$timeout","events.CONSTANTS","dateUtilityService","ageDisclaimerService"],e.directive("eventsList",t)}(angular.module("eventsPageApp")),function(e,t){var a=t.trackEvent,n=function(e,t){return{link:function(e){var n=e;n.search=function(e,r,i){var o=e.item.Id||e.item.LocationId,s=e.item.Name||e.item.Id;n.searchFunction(o,r,i,s,n.items),a({action:r+" Filter Selection",category:t.analytics.bcplEventsCategory,label:s+" - "+(i?"Selected":"Unselected")})},n.removeDisallowedCharacters=function(e){var t=/[^A-Za-z0-9-_.]/g;return e.trim().replace(t,"-")},n.isFilterChecked=function(e,t){var a=e&&"locations"===e?t.LocationId:t.Id;return!!n.activeFilters&&n.activeFilters.includes(a)}},restrict:"E",scope:{filterType:"@",choiceType:"@",searchFunction:"=",items:"=",activeFilters:"="},templateUrl:t.templateUrls.filtersExpandosTemplate}};n.$inject=["metaService","events.CONSTANTS"],e.directive("filtersExpandos",n)}(angular.module("eventsPageApp"),bcpl.utility.googleAnalytics),function(e){var t=function(e,t){return{link:function(e){var t=e;t.search=function(e,a,n){var r=e.item.Id||e.item.LocationId;t.searchFunction(r,a,n)},t.removeDisallowedCharacters=function(e){var t=/[^A-Za-z0-9-_.]/g;return e.trim().replace(t,"-")},t.isFilterChecked=function(e,a){var n=e&&"locations"===e?a.LocationId:a.Id;return t.activeFilters.includes(n)}},restrict:"E",scope:{filterType:"@",choiceType:"@",searchFunction:"=",activeFilters:"="},templateUrl:t.templateUrls.filtersTemplate}};t.$inject=["metaService","events.CONSTANTS"],e.directive("filters",t)}(angular.module("eventsPageApp")),function(e){var t=function(e){return{restrict:"E",templateUrl:e.templateUrls.loadMoreTemplate,scope:{loadNextPage:"=",chunkSize:"="}}};t.$inject=["events.CONSTANTS"],e.directive("loadMore",t)}(angular.module("eventsPageApp"));