"use strict";!function(){var e=angular.module("sharedServices",["sharedConstants"]),t=function(e,t,n){var a=function(){var a=e.defer();return t.get(n.urls.getBranches).then(function(e){return r(e,a)}).catch(function(e){return s(e,a)})},r=function(e,t){var n=e?e.data:"There was a problem getting data, please try again later.";return t.resolve(n),t.promise},s=function(e,t){return t.reject(e),t.promise};return{getBranchesById:function(e){return a().then(function(t){return t.filter(function(t){return e.includes(t.id)})})},getBranchesByName:function(e){return a().then(function(t){return t.filter(function(t){return e.map(function(e){return e.toLowerCase()}).includes(t.name.toLowerCase())})})}}};e.factory("sharedServices.branchesService",["$q","$http","sharedConstants.CONSTANTS",t])}(),function(){var e=angular.module("sharedConstants",[]),t={urls:{getBranches:"data/branch-amenities.json"}};e.constant("sharedConstants.CONSTANTS",t)}(),function(){angular.module("eventsPageApp",["dataServices","events","sharedConstants","sharedServices","ngAria","ngRoute","ngSanitize"])}(),function(){var e=angular.module("events",[]),t={baseUrl:"http://oit226471:1919",serviceUrls:{events:"/api/evanced/signup/events",eventRegistration:"/api/evanced/signup/registration"},remoteServiceUrls:{ageGroups:"https://bcpl.evanced.info/api/signup/agegroups",eventTypes:"https://bcpl.evanced.info/api/signup/eventtypes",locations:"https://bcpl.evanced.info/api/signup/locations"},templateUrls:{datePickersTemplate:"/_js/apps/events-page/templates/datePickers.html",eventsListTemplate:"/_js/apps/events-page/templates/eventsList.html",filtersTemplate:"/_js/apps/events-page/templates/filters.html",filtersExpandosTemplate:"/_js/apps/events-page/templates/filters-expandos.html",loadMoreTemplate:"/_js/apps/events-page/templates/loadMore.html",featuredEventsTemplate:"/_js/apps/events-page/templates/featuredEvents.html"},partialUrls:{eventListPartial:"/_js/apps/events-page/partials/eventList.html",eventDetailsPartial:"/_js/apps/events-page/partials/eventDetails.html",eventRegistrationPartial:"/_js/apps/events-page/partials/eventRegistration.html"},requestChunkSize:10};e.constant("events.CONSTANTS",t)}(),function(e){var t=function(e,t){e.when("/",{templateUrl:t.partialUrls.eventListPartial,controller:"EventsPageCtrl",controllerAs:"eventsPage"}).when("/:id",{templateUrl:t.partialUrls.eventDetailsPartial,controller:"EventDetailsCtrl",controllerAs:"eventDetailsPage"}).when("/register/:id",{templateUrl:t.partialUrls.eventRegistrationPartial,controller:"EventRegistrationCtrl",controllerAs:"eventRegistrationPage"})};t.$inject=["$routeProvider","events.CONSTANTS"],e.config(t)}(angular.module("eventsPageApp")),function(e){var t=angular.module("dataServices",[]),n=function(t,n,a){var r=function(e,t){return new Date(e.EventStart).toLocaleDateString()===t},s=function(e){var t=[],n=void 0;return angular.forEach(e,function(a){var s=new Date(a.EventStart).toLocaleDateString();n!==s&&(t.push({date:new Date(a.EventStart),events:e.filter(function(e){return r(e,s)})}),n=s)}),t},i=function(e){return e.replace(":00","").replace(/\w\w$/,function(e){return e.split("").join(".")+"."})},o=function(t){var n=t,a=e(t.EventStart);return n.eventMonth=a.format("MMM"),n.eventDate=a.format("D"),n.eventTime=i(a.format("h:mm a")),n.requiresRegistration=0!==n.RegistrationTypeCodeEnum,n},u=function(e){return!e.isStarted&&e.requiresRegistration&&(!e.isFull||e.isFull&&e.isWaiting)},l=function(e){var t=[];return e.forEach(function(e){var n=o(e);t.push(n)}),t};return{get:function(e){return a(function(a,r){n.post(t.baseUrl+t.serviceUrls.events,e).then(function(e){e.data?a({eventGroups:s(e.data.Events),totalResults:e.data.TotalResults}):r(e)},r)})},getById:function(r){return a(function(a,s){n.get(t.baseUrl+t.serviceUrls.events+"/"+r).then(function(t){t.data?(t.data.Description&&(t.data.Description=t.data.Description.replace(/<[\w\/]+>/g,"")),t.data.isStarted=e(t.data.EventStart).isBefore(),t.data.isFull=0===t.data.MainSpotsAvailable,t.data.isWaiting=t.data.WaitSpotsAvailable>0,t.data.requiresRegistration=0!==t.data.RegistrationTypeCodeEnum,t.data.shouldDisplayRegistrationButton=u(t.data),a(t.data)):s(t)},s)})},getFeaturedEvents:function(e){return a(function(a,r){n.post(t.baseUrl+t.serviceUrls.events,e).then(function(e){e.data?a(l(e.data.Events)):r(e)},r)})}}};n.$inject=["events.CONSTANTS","$http","$q"],t.factory("dataServices.eventsService",n)}(window.moment),function(e){var t=function(e,t){return{request:function(n){return t(function(t,a){e.get(n).then(function(e){t(e.data)},function(e){a(e)})})}}};t.$inject=["$http","$q"],e.factory("metaService",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,n){return{register:function(a){return n(function(n,r){t.post(e.baseUrl+e.serviceUrls.eventRegistration,a).then(function(e){e.data?n({data:e.data}):r(e)},r)})}}};t.$inject=["events.CONSTANTS","$http","$q"],e.factory("registrationService",t)}(angular.module("eventsPageApp"));var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var t=function(){var e=function(e,t){var n="string"==typeof e?new Date(e):e;return"object"!==(void 0===n?"undefined":_typeof(n))||"Invalid Date"===n?n:(n.setDate(n.getDate()+t),n)},t=function(e,t,r){if(r)return"All Day";if(!e||isNaN(Date.parse(e)))return"Bad start date format";if("number"!=typeof t||t<=0)return"Bad event length format";var s=moment(e),i=moment(e).add(t,"m"),o=n(s),u=s.minute(),l=a(s),c=n(i),v=i.minute(),p=a(i);return o+(0===u?"":":"+u)+" "+(l===p?"":l)+" to "+c+(0===v?"":":"+v)+" "+p},n=function(e){var t=e.hour();return 0===t?12:t<=12?t:t-12},a=function(e){return e.hour()<12?"a.m.":"p.m."};return{addDays:e,formatSchedule:t}};e.factory("dateUtilityService",t)}(angular.module("eventsPageApp")),function(e){var t=function(){return{build:function(e){if(!e)return"";var t=Object.entries(e),n="";return t.length&&angular.forEach(t,function(e){n+=e[0]+"="+e[1]+"&"}),n}}};e.factory("querystringService",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,n,a,r,s){var i=this,o=n.id;i.data={},i.data.EventStartDate="",i.data.EventStartTime="",i.data.EventEndTime="",i.isLoading=!0,i.isError=!1,i.requestErrorMessage="Unfortunately, there was a problem loading this event's details. Please try again in a few minutes.";var u=function(e){i.data=e,i.data.EventStartDate=moment(i.data.EventStart).format("MMMM D, YYYY"),i.data.EventSchedule=s.formatSchedule(i.data.EventStart,i.data.EventLength,i.data.AllDay),i.isRegistrationRequired=0!==i.data.RegistrationTypeCodeEnum,i.isOver=moment().isAfter(moment(i.data.EventStart).add(i.data.EventLength,"m")),i.isLoading=!1},l=function(e){i.isLoading=!1,i.isError=!0};r.getById(o).then(u).catch(l)};t.$inject=["$scope","$timeout","$routeParams","events.CONSTANTS","dataServices.eventsService","dateUtilityService"],e.controller("EventDetailsCtrl",t)}(angular.module("eventsPageApp")),function(e,t){var n=function(e,n,a,r,s,i){var o=a.id,u=this;u.isGroup="false",u.isSubmitted=!1,u.isLoadingResults=!1,u.formConfirmationMessage=null,u.submitHandler=function(){u.isLoadingResults=!0;var e={EventId:parseInt(o,10),FirstName:u.firstName,LastName:u.lastName,Email:u.email,Phone:t("phoneNumber",u.phone,"xxx-xxx-xxxx"),IsGroup:"true"===u.isGroup,GroupCount:u.groupCount};s.register(e).then(function(e){var t=angular.element(".main-content").first().offset().top;u.postResult=e.data;var n=u.postResult.Data;if(n.ConfirmationMessage&&n.ConfirmationMessage.length)u.formConfirmationMessage=n.ConfirmationMessage;else{var a=u.postResult&&Object.hasOwnProperty.call(u.postResult,"Errors")&&u.postResult.Errors.length;u.formConfirmationMessage=a?u.postResult.Errors[0].Error:"Something went wrong, please try again later"}u.isSubmitted=!0,u.isLoadingResults=!1,angular.element("html, body").animate({scrollTop:t},250)})};var l=function(e){u.data=e,u.data.EventSchedule=i.formatSchedule(u.data.EventStart,u.data.EventLength,u.data.AllDay)};r.getById(o).then(l)};n.$inject=["$window","$scope","$routeParams","dataServices.eventsService","registrationService","dateUtilityService"],e.controller("EventRegistrationCtrl",n)}(angular.module("eventsPageApp"),bcpl.utility.format),function(e){var t=function(e,t,n,a,r,s,i){var o=this,u=moment().format(),l=moment().add(30,"d"),c=l.format(),v={StartDate:u,EndDate:c,Page:1,IsOngoingVisible:!0,IsSpacesReservationVisible:!1,Limit:r.requestChunkSize,EventsTypes:[],AgeGroups:[],Locations:[]},p={zIndex:100,responsiveWidth:!0};o.eventGroups=[],o.keywords="",o.chunkSize=r.requestChunkSize,o.totalResults=0,o.isLastPage=!1,o.areDatesInvalid=!1,o.isLoading=!0,o.hasResults=!0,o.locations=v.Locations,o.eventsTypes=v.EventsTypes,o.ageGroups=v.AgeGroups,o.keywordSearch=function(){v.Keyword=o.keywords,v.StartDate=u,v.Page=1,o.eventGroups=[],o.hasResults=!0,o.isLoading=!0,s.get(v).then(m).catch(d)},o.filterByDate=function(){o.areDatesInvalid=!S(o.userStartDate,o.userEndDate),o.areDatesInvalid||(v.StartDate=o.userStartDate,v.EndDate=o.userEndDate,v.Page=1,o.eventGroups=[],o.hasResults=!0,o.isLoading=!0,o.requestErrorMessage="",s.get(v).then(m).catch(d))},o.filterByTerms=function(e,t,n){switch(t.toLowerCase()){case"locations":f(v.Locations,e,n);break;case"agegroups":f(v.AgeGroups,e,n);break;case"eventtypes":f(v.EventsTypes,e,n)}o.eventGroups=[],o.hasResults=!0,o.isLoading=!0,s.get(v).then(m).catch(d)};var d=function(e){o.isLoading=!1,o.requestErrorMessage="There was a problem retrieving events. Please try again later."},f=function(e,t,n){if(n)e.push(t);else{var a=e.indexOf(t);-1!==a&&e.splice(a,1)}};o.loadNextPage=function(){v.Page+=1,s.get(v).then(g).then(function(){t(function(){$(".event-date-bar").sticky(p)})})},o.clearFilters=function(){v.StartDate=u,v.EndDate=c,v.Page=1,v.Keyword="",v.AgeGroups=[],v.EventsTypes=[],v.Locations=[],o.keywords="",o.userStartDate="",o.userEndDate="",o.eventGroups=[],o.hasResults=!0,o.isLoading=!0,o.locations=v.Locations,o.eventsTypes=v.EventsTypes,o.ageGroups=v.AgeGroups,s.get(v).then(m).catch(d)};var m=function(e){o.isLastPage=h(e.totalResults),o.eventGroups=e.eventGroups,o.isLoading=!1,o.hasResults=e.eventGroups.length,o.requestErrorMessage="",t(function(){$(".event-date-bar").sticky(p)})},g=function(e){o.isLastPage=h(e.totalResults),o.eventGroups=E(o.eventGroups,e.eventGroups)},h=function(e){return v.Page*o.chunkSize>=e},S=function(e,t){return!(!e||!t)&&moment(e).isSameOrBefore(t)},y=function(e,t){return!(!e||!t)&&moment(e).isSame(t,"day")},E=function(e,t){var n=e,a=n[n.length-1];return angular.forEach(t,function(e){y(a.date,e.date)?a.events=a.events.concat(e.events):n.push(e)}),n},D=function(e){angular.element(e.currentTarget).closest(".expando-wrapper").find("i").toggleClass("fa-plus-square").toggleClass("fa-minus-square")};angular.element(document).on("hide.bs.collapse",".expando-wrapper .collapse",D),angular.element(document).on("show.bs.collapse",".expando-wrapper .collapse",D);var T=function(){return a.search().term&&a.search().term.length?a.search().term:""}();if(a.search().branches){var P=a.search().branches.split(",");i.getBranchesByName(P).then(function(e){console.log("branches",e)})}T?(o.keywords=T,o.keywordSearch()):s.get(v).then(m).catch(d)};t.$inject=["$scope","$timeout","$animate","$location","events.CONSTANTS","dataServices.eventsService","sharedServices.branchesService"],e.controller("EventsPageCtrl",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{link:function(t,n,a){var r=t;r.areDatesInvalid=!1;var s={dateFormat:"F d, Y",disable:[function(e){return moment(e).isBefore(new Date,"day")}],onChange:function(){e(function(){r.userStartDate=r.userStartDate||r.userEndDate,r.userEndDate=r.userEndDate||r.userStartDate,e(function(){moment(r.userStartDate).isSameOrBefore(r.userEndDate)?(r.areDatesInvalid=!1,r.filterByDate()):r.areDatesInvalid=!0})})}};r.openFlatpickr=function(e){document.querySelector("#"+e)._flatpickr.open()},flatpickr("#start-date, #end-date",s)},restrict:"E",templateUrl:t.templateUrls.datePickersTemplate,scope:{userStartDate:"=startDateModel",userEndDate:"=endDateModel",filterByDate:"=filterByDate"}}};t.$inject=["$timeout","events.CONSTANTS"],e.directive("datePickers",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,n){var a=function(e){var t=e,a={weekday:"long",year:"numeric",month:"long",day:"numeric"};t.eventScheduleString=function(e){return n.formatSchedule(e.EventStart,e.EventLength,e.AllDay)},t.getDisplayDate=function(e){return e.date.toLocaleDateString("en-US",a)}};return{restrict:"E",templateUrl:t.templateUrls.eventsListTemplate,link:a,scope:{eventGroups:"="}}};t.$inject=["$timeout","events.CONSTANTS","dateUtilityService"],e.directive("eventsList",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{link:function(n){var a=n,r=function(e){a.items=e};a.search=function(e,t,n){var r=e.item.Id||e.item.LocationId;a.searchFunction(r,t,n)},a.removeDisallowedCharacters=function(e){var t=/[^A-Za-z0-9-_.]/g;return e.trim().replace(t,"-")},a.items=[],t.remoteServiceUrls[a.filterType]&&e.request(t.remoteServiceUrls[a.filterType]).then(r)},restrict:"E",scope:{filterType:"@",choiceType:"@",searchFunction:"="},templateUrl:t.templateUrls.filtersExpandosTemplate}};t.$inject=["metaService","events.CONSTANTS"],e.directive("filtersExpandos",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{link:function(n){var a=n,r=function(e){a.items=e};a.search=function(e,t,n){var r=e.item.Id||e.item.LocationId;a.searchFunction(r,t,n)},a.removeDisallowedCharacters=function(e){var t=/[^A-Za-z0-9-_.]/g;return e.trim().replace(t,"-")},a.items=[],t.remoteServiceUrls[a.filterType]&&e.request(t.remoteServiceUrls[a.filterType]).then(r)},restrict:"E",scope:{filterType:"@",choiceType:"@",searchFunction:"="},templateUrl:t.templateUrls.filtersTemplate}};t.$inject=["metaService","events.CONSTANTS"],e.directive("filters",t)}(angular.module("eventsPageApp")),function(e){var t=function(e){return{restrict:"E",templateUrl:e.templateUrls.loadMoreTemplate,scope:{loadNextPage:"=",chunkSize:"="}}};t.$inject=["events.CONSTANTS"],e.directive("loadMore",t)}(angular.module("eventsPageApp"));