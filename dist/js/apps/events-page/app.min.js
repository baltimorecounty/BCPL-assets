"use strict";!function(){angular.module("eventsPageApp",["ngAnimate","ngRoute"]).config(function(e,t){e.when("/",{templateUrl:"/js/apps/events-page/partials/eventList.html",controller:"EventsPageCtrl",controllerAs:"eventsPage"}).when("/:id",{templateUrl:"/js/apps/events-page/partials/eventDetails.html",controller:"EventDetailsCtrl",controllerAs:"eventDetailsPage"})})}(),function(e){var t={baseUrl:"https://testservices.bcpl.info",serviceUrls:{events:"/api/evanced/signup/events"},remoteServiceUrls:{ageGroups:"https://bcpl.evanced.info/api/signup/agegroups",eventTypes:"https://bcpl.evanced.info/api/signup/eventtypes",locations:"https://bcpl.evanced.info/api/signup/locations"},templateUrls:{datePickersTemplate:"/js/apps/events-page/templates/datePickers.html",eventsListTemplate:"/js/apps/events-page/templates/eventsList.html",filtersTemplate:"/js/apps/events-page/templates/filters.html",filtersExpandosTemplate:"/js/apps/events-page/templates/filters-expandos.html",loadMoreTemplate:"/js/apps/events-page/templates/loadMore.html"},requestChunkSize:10};e.constant("CONSTANTS",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,n){var a=function(e,t){return new Date(e.EventStart).toLocaleDateString()===t},r=function(e){var t=[],n=void 0;return angular.forEach(e,function(r){var s=new Date(r.EventStart).toLocaleDateString();n!==s&&(t.push({date:new Date(r.EventStart),events:e.filter(function(e){return a(e,s)})}),n=s)}),t};return{get:function(a){return n(function(n,s){t.post(e.baseUrl+e.serviceUrls.events,a).then(function(e){e.data?n({eventGroups:r(e.data.Events),totalResults:e.data.TotalResults}):s(e)},s)})},getById:function(a){return n(function(n,r){t.get(e.baseUrl+e.serviceUrls.events+"/"+a).then(function(e){e.data?n(e.data):r(e)},r)})}}};t.$inject=["CONSTANTS","$http","$q"],e.factory("eventsService",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{request:function(n){return t(function(t,a){e.get(n).then(function(e){t(e.data)},function(e){a(e)})})}}};t.$inject=["$http","$q"],e.factory("metaService",t)}(angular.module("eventsPageApp"));var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var t=function(){var e=function(e,t){var n="string"==typeof e?new Date(e):e;return"object"!==(void 0===n?"undefined":_typeof(n))||"Invalid Date"===n?n:(n.setDate(n.getDate()+t),n)},t=function(e,t){if(!e||isNaN(Date.parse(e)))return"Bad start date format";if("number"!=typeof t||t<=0)return"Bad event length format";var r=moment(e),s=moment(e).add(t,"m"),o=n(r),i=r.minute(),l=a(r),u=n(s),c=s.minute(),p=a(s);return o+(0===i?"":":"+i)+" "+(l===p?"":l)+" to "+u+(0===c?"":":"+c)+" "+p},n=function(e){var t=e.hour();return 0===t?12:t<=12?t:t-12},a=function(e){return e.hour()<12?"a.m.":"p.m."};return{addDays:e,formatSchedule:t}};e.factory("dateUtilityService",t)}(angular.module("eventsPageApp")),function(e){var t=function(){return{build:function(e){if(!e)return"";var t=Object.entries(e),n="";return t.length&&angular.forEach(t,function(e){n+=e[0]+"="+e[1]+"&"}),n}}};e.factory("querystringService",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,n,a,r,s){var o=this,i=n.id;o.data={},o.data.EventStartDate="",o.data.EventStartTime="",o.data.EventEndTime="";var l=function(e){o.data=e,o.data.EventStartDate=moment(o.data.EventStart).format("MMMM D, YYYY"),o.data.EventSchedule=s.formatSchedule(o.data.EventStart,o.data.EventLength),o.isRegistrationRequired=0!==o.data.RegistrationTypeCodeEnum,o.isOver=moment().isAfter(moment(o.data.EventStart).add(o.data.EventLength,"m")),console.log(e)};r.getById(i).then(l)};t.$inject=["$scope","$timeout","$routeParams","CONSTANTS","eventsService","dateUtilityService"],e.controller("EventDetailsCtrl",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,n,a,r){var s=this,o=moment().format(),i=moment().add(30,"d"),l=i.format(),u={StartDate:o,EndDate:l,Page:1,IsOngoingVisible:!0,IsSpacesReservationVisible:!1,Limit:a.requestChunkSize,EventsTypes:[],AgeGroups:[],Locations:[]},c={zIndex:100,responsiveWidth:!0};s.eventGroups=[],s.keywords="",s.chunkSize=a.requestChunkSize,s.totalResults=0,s.isLastPage=!1,s.areDatesInvalid=!1,s.isLoading=!0,s.hasResults=!0,s.locations=u.Locations,s.eventsTypes=u.EventsTypes,s.ageGroups=u.AgeGroups,s.keywordSearch=function(){u.Keyword=s.keywords,u.StartDate=o,u.Page=1,s.eventGroups=[],s.hasResults=!0,s.isLoading=!0,r.get(u).then(v)},s.filterByDate=function(){m(s.userStartDate,s.userEndDate)?(s.areDatesInvalid=!1,u.StartDate=s.userStartDate,u.EndDate=s.userEndDate,u.Page=1,s.eventGroups=[],s.hasResults=!0,s.isLoading=!0,r.get(u).then(v)):s.areDatesInvalid=!0},s.filterByTerms=function(e,t,n){switch(t.toLowerCase()){case"locations":p(u.Locations,e,n);break;case"agegroups":p(u.AgeGroups,e,n);break;case"eventtypes":p(u.EventsTypes,e,n)}s.eventGroups=[],s.hasResults=!0,s.isLoading=!0,r.get(u).then(v)};var p=function(e,t,n){if(n)e.push(t);else{var a=e.indexOf(t);-1!==a&&e.splice(a,1)}};s.loadNextPage=function(){u.Page+=1,r.get(u).then(d).then(function(){t(function(){$(".event-date-bar").sticky(c)})})},s.clearFilters=function(){u.StartDate=o,u.EndDate=l,u.Page=1,u.Keyword="",u.AgeGroups=[],u.EventsTypes=[],u.Locations=[],s.keywords="",s.userStartDate="",s.userEndDate="",s.eventGroups=[],s.hasResults=!0,s.isLoading=!0,s.locations=u.Locations,s.eventsTypes=u.EventsTypes,s.ageGroups=u.AgeGroups,r.get(u).then(v)};var v=function(e){s.isLastPage=f(e.totalResults),s.eventGroups=e.eventGroups,s.isLoading=!1,s.hasResults=e.eventGroups.length,t(function(){$(".event-date-bar").sticky(c)})},d=function(e){s.isLastPage=f(e.totalResults),s.eventGroups=h(s.eventGroups,e.eventGroups)},f=function(e){return u.Page*s.chunkSize>=e},m=function(e,t){return!(!e||!t)&&moment(e).isSameOrBefore(t)},g=function(e,t){return!(!e||!t)&&moment(e).isSame(t,"day")},h=function(e,t){var n=e,a=n[n.length-1];return angular.forEach(t,function(e){g(a.date,e.date)?a.events=a.events.concat(e.events):n.push(e)}),n},S=function(e){angular.element(e.currentTarget).siblings(".collapse-control").html('<i class="fa fa-minus"></i> Hide Filters')},y=function(e){angular.element(e.currentTarget).siblings(".collapse-control").html('<i class="fa fa-plus"></i> Show Filters')},D=function(e){angular.element(e.currentTarget).closest(".expando-wrapper").find("i").toggleClass("fa-plus-square").toggleClass("fa-minus-square")};angular.element(document).on("hidden.bs.collapse","#filter-items-wrapper",y),angular.element(document).on("shown.bs.collapse","#filter-items-wrapper",S),angular.element(document).on("hide.bs.collapse",".expando-wrapper .collapse",D),angular.element(document).on("show.bs.collapse",".expando-wrapper .collapse",D),r.get(u).then(v)};t.$inject=["$scope","$timeout","$animate","CONSTANTS","eventsService","dateUtilityService"],e.controller("EventsPageCtrl",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{link:function(t,n,a){var r=t;r.areDatesInvalid=!1;var s={dateFormat:"F d, Y",disable:[function(e){return moment(e).isBefore(new Date,"day")}],onChange:function(){e(function(){r.userStartDate=r.userStartDate||r.userEndDate,r.userEndDate=r.userEndDate||r.userStartDate,e(function(){moment(r.userStartDate).isSameOrBefore(r.userEndDate)?(r.areDatesInvalid=!1,r.filterByDate()):r.areDatesInvalid=!0})})}};r.openFlatpickr=function(e){document.querySelector("#"+e)._flatpickr.open()},flatpickr("#start-date, #end-date",s)},restrict:"E",templateUrl:t.templateUrls.datePickersTemplate,scope:{userStartDate:"=startDateModel",userEndDate:"=endDateModel",filterByDate:"=filterByDate"}}};t.$inject=["$timeout","CONSTANTS"],e.directive("datePickers",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t,n){var a=function(e){var t=e,a={weekday:"long",year:"numeric",month:"long",day:"numeric"};t.eventScheduleString=function(e){return n.formatSchedule(e.EventStart,e.EventLength)},t.getDisplayDate=function(e){return e.date.toLocaleDateString("en-US",a)}};return{restrict:"E",templateUrl:t.templateUrls.eventsListTemplate,link:a,scope:{eventGroups:"="}}};t.$inject=["$timeout","CONSTANTS","dateUtilityService"],e.directive("eventsList",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{link:function(n){var a=n,r=function(e){a.items=e};a.search=function(e,t,n){var r=e.item.Id||e.item.LocationId;a.searchFunction(r,t,n)},a.removeDisallowedCharacters=function(e){var t=/[^A-Za-z0-9-_.]/g;return e.trim().replace(t,"-")},a.items=[],t.remoteServiceUrls[a.filterType]&&e.request(t.remoteServiceUrls[a.filterType]).then(r)},restrict:"E",scope:{filterType:"@",choiceType:"@",searchFunction:"="},templateUrl:t.templateUrls.filtersExpandosTemplate}};t.$inject=["metaService","CONSTANTS"],e.directive("filtersExpandos",t)}(angular.module("eventsPageApp")),function(e){var t=function(e,t){return{link:function(n){var a=n,r=function(e){a.items=e};a.search=function(e,t,n){var r=e.item.Id||e.item.LocationId;a.searchFunction(r,t,n)},a.removeDisallowedCharacters=function(e){var t=/[^A-Za-z0-9-_.]/g;return e.trim().replace(t,"-")},a.items=[],t.remoteServiceUrls[a.filterType]&&e.request(t.remoteServiceUrls[a.filterType]).then(r)},restrict:"E",scope:{filterType:"@",choiceType:"@",searchFunction:"="},templateUrl:t.templateUrls.filtersTemplate}};t.$inject=["metaService","CONSTANTS"],e.directive("filters",t)}(angular.module("eventsPageApp")),function(e){var t=function(e){return{restrict:"E",templateUrl:e.templateUrls.loadMoreTemplate,scope:{loadNextPage:"=",chunkSize:"="}}};t.$inject=["CONSTANTS"],e.directive("loadMore",t)}(angular.module("eventsPageApp"));