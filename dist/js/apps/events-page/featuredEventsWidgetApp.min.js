"use strict";!function(t){var e=angular.module("dataServices",[]),a=function(e,a,n){var r=function(t,e){return new Date(t.EventStart).toLocaleDateString()===e},s=function(e){var a=[],n=void 0;return angular.forEach(e,function(s){var i=s.EventStart?s:c(s,t()),o=new Date(i.EventStart).toLocaleDateString();if(n!==o){var l=i.EventStart||i.OnGoingStartDate,p=e.filter(function(t){return r(t,o)});a.push({date:new Date(l),events:p}),n=o}}),a},i=function(e,a){return t(e.date).isSame(a.date,"day")?0:t(e.date).isBefore(a.date)?-1:1},o=function(t){return n(function(n,r){a.post(e.baseUrl+e.serviceUrls.events,t).then(function(t){if(t.data){var e=s(t.data.Events),a=e.sort(i);n({eventGroups:a,totalResults:t.data.TotalResults})}else r(t)},r)})},l=function(r){return n(function(n,s){a.get(e.baseUrl+e.serviceUrls.events+"/"+r).then(function(e){if(e.data){e.data.Description&&(e.data.Description=e.data.Description.replace(/<[\w\/]+>/g,""));e.data.registrationStarts=t(e.data.EventStart).subtract(7,"days"),e.data.registrationEnds=t(e.data.EventStart).subtract(30,"minutes"),e.data.registrationStartsDisplay=p(e.data.registrationStarts.format("M/D/YYYY @ h:mm a")),e.data.registrationEndsDisplay=p(e.data.registrationEnds.format("M/D/YYYY @ h:mm a")),e.data.onGoingStartDate=t(e.data.OnGoingStartDate).format("M/D/YYYY"),e.data.onGoingEndDate=t(e.data.OnGoingEndDate).format("M/D/YYYY"),e.data.isStarted=t(e.data.EventStart).isBefore(),e.data.isRegistrationClosed=e.data.registrationEnds.isBefore(),e.data.isRegistrationWindow=t().isBetween(e.data.registrationStarts,e.data.registrationEnds),e.data.isFull=1===e.data.RegistrationTypeCodeEnum&&0===e.data.MainSpotsAvailable,e.data.isWaiting=e.data.WaitSpotsAvailable>0,e.data.requiresRegistration=0!==e.data.RegistrationTypeCodeEnum,e.data.shouldDisplayRegistrationButton=d(e.data),n(e.data)}else s(e)},s)})},p=function(t){return t.replace(":00","").replace(/\w\w$/,function(t){return t.split("").join(".")+"."})},u=function(e){var a=e,n=t(e.EventStart);return a.eventMonth=n.format("MMM"),a.eventDate=n.format("D"),a.eventTime=p(n.format("h:mm a")),a.requiresRegistration=0!==a.RegistrationTypeCodeEnum,a},d=function(t){return!t.isStarted&&t.isRegistrationWindow&&t.requiresRegistration&&(!t.isFull||t.isFull&&t.isWaiting)},v=function(t){var e=[];return t.forEach(function(t){var a=u(t);e.push(a)}),e},c=function(e,a){var n=t(e.OnGoingStartDate),r=t(n).isSame(a,"day"),s=e,i=n.isAfter(a);return s.EventStart=(i||r)&&e.OnGoingStartDate,s.EventStart||(s.EventStart=a),s};return{get:o,getById:l,getFeaturedEvents:function(t){return n(function(n,r){a.post(e.baseUrl+e.serviceUrls.events,t).then(function(t){t.data?n(v(t.data.Events)):r(t)},r)})}}};a.$inject=["events.CONSTANTS","$http","$q"],e.factory("dataServices.eventsService",a)}(window.moment),function(){angular.module("featuredEventsWidgetApp",["dataServices","events","ngAria"])}(),function(){var t=angular.module("events",[]),e={baseUrl:"http://oit226471:1919",serviceUrls:{events:"/api/evanced/signup/events",eventRegistration:"/api/evanced/signup/registration",eventTypes:"/api/evanced/signup/eventtypes"},remoteServiceUrls:{ageGroups:"https://bcpl.evanced.info/api/signup/agegroups",locations:"https://bcpl.evanced.info/api/signup/locations"},templateUrls:{datePickersTemplate:"/_js/apps/events-page/templates/datePickers.html",eventsListTemplate:"/_js/apps/events-page/templates/eventsList.html",filtersTemplate:"/_js/apps/events-page/templates/filters.html",filtersExpandosTemplate:"/_js/apps/events-page/templates/filters-expandos.html",loadMoreTemplate:"/_js/apps/events-page/templates/loadMore.html",featuredEventsTemplate:"/_js/apps/events-page/templates/featuredEvents.html"},partialUrls:{eventListPartial:"/_js/apps/events-page/partials/eventList.html",eventDetailsPartial:"/_js/apps/events-page/partials/eventDetails.html",eventRegistrationPartial:"/_js/apps/events-page/partials/eventRegistration.html"},requestChunkSize:10};t.constant("events.CONSTANTS",e)}(),function(t){var e=function(t,e){var a=t.branches&&t.branches.length?t.branches:[],n=t.eventTypes&&t.eventTypes.length?t.eventTypes:[],r=t.resultsToDisplay||3,s=!!t.prioritizeFeatured,i=function(t){return console.error(t)},o=function(t,e,r,s){var i={Limit:t,OnlyFeaturedEvents:s};return a.length&&(i.Locations=e),n.length&&(i.EventsTypes=r),i}(r,a,n,s);e.getFeaturedEvents(o).then(function(e){t.featuredEventList=e,0===e.length&&(t.resultsToDisplay=0)}).catch(i)},a=function(t,a){return{restrict:"E",scope:{branches:"=",resultsToDisplay:"=",eventTypes:"=",prioritizeFeatured:"="},templateUrl:t.templateUrls.featuredEventsTemplate,link:function(t){return e(t,a)}}};a.$inject=["events.CONSTANTS","dataServices.eventsService"],t.directive("featuredEvents",a)}(angular.module("featuredEventsWidgetApp"));