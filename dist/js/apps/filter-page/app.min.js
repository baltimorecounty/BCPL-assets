"use strict";!function(){angular.module("filterPageApp",["ngAnimate"])}(),function(t){var e={templates:{databases:"/dist/js/apps/filter-page/templates/card-databases.html",locations:"/dist/js/apps/filter-page/templates/card-locations.html"},urls:{databases:"/_structured-content/BCPL_Databases",locations:"/mockups/data/branch-amenities.json"}};t.constant("CONSTANTS",e)}(angular.module("filterPageApp")),function(t){var e=function(t){return function(e,a){var r=[];return angular.forEach(e,function(e){var n=0;angular.forEach(e.attributes,function(e){-1!==a.indexOf(t.extractTagName(e))&&(n+=1)}),n===a.length&&r.push(e)}),r}};e.$inject=["tagParsingService"],t.filter("cardVisibilityFilter",e)}(angular.module("filterPageApp")),function(t){var e=function(t){var e={name:0,url:1,description:2,inPerson:3,requiresCard:4,attributes:5},a=function(t){var e=[];return t.each(function(t,a){var r=$(a).text().trim();r.length&&e.push(r)}),e},r=function(t,r){var n=$(t).find("#data-table"),i=n.find("tbody tr"),l=[];i.each(function(t,r){var n=$(r);l.push({name:n.find("td").eq(e.name).text(),url:n.find("td").eq(e.url).text(),description:n.find("td").eq(e.description).text(),inPerson:n.find("td").eq(e.inPerson).text(),requiresCard:n.find("td").eq(e.requiresCard).text(),attributes:a(n.find("td").eq(e.attributes).find(".SETags"))})}),r(l)};return{get:function(e,a){$.ajax(t.urls.databases).done(function(t){r(t,e)}).fail(a)}}};e.$inject=["CONSTANTS"],t.factory("databasesService",e)}(angular.module("filterPageApp")),function(t){var e=function(t){var e=function(t,e){e("string"==typeof t?JSON.parse(t):t)};return{get:function(a,r){$.ajax(t.urls.locations).done(function(t){e(t,a)}).fail(r)}}};e.$inject=["CONSTANTS"],t.factory("locationsService",e)}(angular.module("filterPageApp")),function(t){var e=function(t,e,a){var r=function(t){var e=[];return angular.forEach(t,function(t){e=e.concat(t.attributes)}),_.uniq(e).filter(function(t){return t.trim().length>0})},n=function(t){var e=t.split("/");return e[e.length-1].split(".")[0]};return{get:function(t){var i=n(e.location.pathname);a.get(i+"Service").get(function(e){var a=r(e),n=_.sortBy(e,function(t){return t.name});t(a,n)})}}};e.$inject=["$location","$window","$injector"],t.factory("cardService",e)}(angular.module("filterPageApp")),function(t){var e=function(){var t={name:0,tag:1,type:2},e=function(t){if("string"==typeof t){var e=t.trim().split("|");return e.length>1?e[1]:e[0]}return""},a=function(t,e){var a=t.filter(function(t){return t.name===e});return 1===a.length?a[0]:void 0},r=function(t,e,a){return{name:t,type:a,tags:[e]}};return{parseTags:function(e){if(!Array.isArray(e))return[];var n=[];return e.forEach(function(e){var i=e.split("|").map(function(t){return t.trim()});1===i.length&&i.unshift("none"),2===i.length&&i.push("many");var l=a(n,i[t.name]);if(l)l.tags.push(i[t.tag]),l.type=i[t.type];else{var c=r(i[t.name],i[t.tag],i[t.type]);n.push(c)}}),n.forEach(function(t){var e=t;e.tags=_.sortBy(e.tags,function(t){return t})}),n},extractTagName:e}};t.factory("tagParsingService",e)}(angular.module("filterPageApp")),function(t){var e=function(t,e,a,r,n){var i=this;i.activeFilters=[],i.allCardData={},i.isEverythingFilteredOut=!1,i.setFilter=function(t,e){var a=angular.element("#results-display");s(t,e),r.addClass(a,"fade-out"),i.items=i.allCardData.filter(u),a.trigger("bcpl.filter.changed",{items:i.items}),bcpl.utility.windowShade.cycle(250,2e3),n(function(){r.removeClass(a,"fade-out")},250)};var l=function(e,a){i.filters=e,i.allCardData=a,i.items=a,angular.element("#results-display").trigger("bcpl.filter.changed",{items:i.items}),t.$apply()},c=function(t){var e=t.attributes,r=[];return e.forEach(function(t){var e=a.extractTagName(t);e.length>0&&r.push(e)}),r},u=function(t){var e=0;if(!t)return!1;var a=c(t);return angular.forEach(i.activeFilters,function(t){-1!==a.indexOf(t)&&(e+=1)}),e===i.activeFilters.length},s=function(t,e){var a=i.activeFilters.indexOf(t),r=-1===a,n="one"===e.type.trim().toLowerCase(),l=[];r&&n&&angular.forEach(e.tags,function(e){e!==t&&l.push(e)}),angular.forEach(l,function(t){-1!==i.activeFilters.indexOf(t)&&i.activeFilters.splice(i.activeFilters.indexOf(t),1)}),r?i.activeFilters.push(t):i.activeFilters.splice(a,1)},o=function(t){angular.element(t.currentTarget).siblings(".collapse-control").html('<i class="fa fa-minus"></i> Hide Filters')},f=function(t){angular.element(t.currentTarget).siblings(".collapse-control").html('<i class="fa fa-plus"></i> Show Filters')};e.get(l),angular.element(document).on("show.bs.collapse","#filters",o),angular.element(document).on("hide.bs.collapse","#filters",f)};e.$inject=["$scope","cardService","tagParsingService","$animate","$timeout"],t.controller("FilterPageCtrl",e)}(angular.module("filterPageApp")),function(t){var e=function(t,e,a,r){return{restrict:"E",scope:{filterHandler:"=",cardData:"=",activeFilters:"=",template:"="},template:"",link:function(e,n,i){a(r.templates[i.template]).then(function(a){n.append(t(a)(e))})}}};e.$inject=["$compile","$injector","$templateRequest","CONSTANTS"],t.directive("card",e)}(angular.module("filterPageApp")),function(t){var e=function(){return{scope:{tag:"=",activeFilters:"=",filterHandler:"=",filterFamily:"="},restrict:"E",templateUrl:"/dist/js/apps/filter-page/templates/filter.html",link:function(t,e){var a=angular.element(e),r=a.find("input"),n="many"===t.filterFamily.type.trim().toLowerCase()?"checkbox":"radio";r.prop("type",n),"radio"===n&&r.prop("name",t.filterFamily.name),t.toggleFilter=function(e){t.isFilterChecked=a.has(":checked").length>0,t.filterHandler(e,t.filterFamily)}}}};e.$inject=[],t.directive("filter",e)}(angular.module("filterPageApp")),function(t){var e=function(t){return{scope:{filterHandler:"=",filterData:"=",activeFilters:"="},restrict:"E",templateUrl:"/dist/js/apps/filter-page/templates/filters.html",link:function(e){e.$watch("filterData",function(){e.filterFamilies=t.parseTags(e.filterData)})}}};e.$inject=["tagParsingService"],t.directive("filters",e)}(angular.module("filterPageApp")),function(t){var e=function(t){return{scope:{filterHandler:"=",tagData:"=",activeFilters:"="},restrict:"E",templateUrl:"/dist/js/apps/filter-page/templates/tag.html",link:function(e){e.toggleFilter=function(a){var r=t.parseTags(e.tagData.attributes),n=t.extractTagName(a),i=r.filter(function(t){return-1!==t.tags.indexOf(n)});i.length&&e.filterHandler(n,i[0])},e.extractTagName=t.extractTagName}}};e.$inject=["tagParsingService"],t.directive("tag",e)}(angular.module("filterPageApp"));