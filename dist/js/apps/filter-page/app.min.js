"use strict";!function(){var e=angular.module("sharedFilters",[]),t=function(e){var t=function(t){var a={};if(t){var r=e.search();t.forEach(function(e){delete r[e],a=r})}e.search(a)},a=function(e,t){return!!t&&!!Object.keys(e).filter(function(e){return e.toLowerCase()===t.toLowerCase()}).length},r=function(e,t){return e?e&&e.indexOf(",")>-1?t?e:e.split(","):[e]:[]},n=function(){return e.search()},i=function(e,t,a){return Object.hasOwnProperty.call(e,t)?r(e[t],a):a?"":[]},l=function(t){if(t){var a=e.search();t.forEach(function(e){var t=e.key,r=e.val;r?a[t]=r:delete a[t]}),e.search(a)}};return{clearQueryParams:t,doesKeyExist:a,getFiltersFromString:r,getQueryParams:n,getQueryParamValuesByKey:i,setQueryParams:l,updateQueryParams:function(e){if(e){var r=[];e.forEach(function(e){var l=e.key,c=e.val,o=n();if(a(o,l)){var u=i(o,l),s=u.includes(c),f=[];if(s){var p=u.indexOf(c);u.splice(p,1)}else u.push(c);f=u,f.length?r.push({key:l,val:f.join(",")}):t([l])}else r.push({key:l,val:c})}),l(r)}}}};e.factory("sharedFilters.filterHelperService",["$location",t])}(),namespacer("bcpl"),bcpl.boostrapCollapseHelper=function(e){return{toggleCollapseByIds:function(t){t.forEach(function(t){e("#"+t).collapse("show")})}}}(jQuery),function(){angular.module("filterPageApp",["ngAnimate"]).config(function(e){e.html5Mode({enabled:!0,requireBase:!1})})}(),function(e){var t={templates:{databases:"/js/apps/filter-page/templates/card-databases.html",locations:"/js/apps/filter-page/templates/card-locations.html"},urls:{databases:"https://testservices.bcpl.info/api/structured-content/databases",locations:"/sebin/q/r/branch-amenities.json"},filters:{tags:{types:{pickOne:"one",pickMany:"many"}}}};e.constant("CONSTANTS",t)}(angular.module("filterPageApp")),function(e){var t=function(){return function(e,t){var a=[];return angular.forEach(e,function(e){var r=0;angular.forEach(e.Tags,function(e){-1!==t.indexOf(e.Tag)&&(r+=1)}),r===t.length&&a.push(e)}),a}};t.$inject=[],e.filter("cardVisibilityFilter",t)}(angular.module("filterPageApp")),function(e){var t=function(e){return{get:function(t,a){$.ajax(e.urls.databases).done(t).fail(a)}}};t.$inject=["CONSTANTS"],e.factory("databasesService",t)}(angular.module("filterPageApp")),function(e){var t=function(e){var t=function(e,t){t("string"==typeof e?JSON.parse(e):e)};return{get:function(a,r){$.ajax(e.urls.locations).done(function(e){t(e,a)}).fail(r)}}};t.$inject=["CONSTANTS"],e.factory("locationsService",t)}(angular.module("filterPageApp")),function(e){var t=function(e,t,a){var r=function(e){var t=e.split("/");return t[t.length-1].split(".")[0]};return{get:function(e){var n=r(t.location.pathname);a.get(n+"Service").get(function(t){var a=_.sortBy(t,function(e){return e.Title});e(a)})}}};t.$inject=["$location","$window","$injector"],e.factory("cardService",t)}(angular.module("filterPageApp")),function(e){var t=function(){var e=function(e){var t=[];return angular.forEach(e,function(e){t=t.concat(e.Tags)}),t},t=function(e){return _.uniq(_.pluck(e,"Name"),function(e){return e})},a=function(e,t){var a=_.where(t,{Name:e});return _.uniq(_.sortBy(_.pluck(a,"Tag"),function(e){return e}),function(e){return e})},r=function(e,t){var a=_.findWhere(t,{Name:e});return a?a.Type:"none"};return{build:function(n){var i=[],l=e(n),c=t(l);return angular.forEach(c,function(e){i.push({name:e,tags:a(e,l),type:r(e,l)})}),i},transformAttributesToTags:function(e){var t=[];return angular.forEach(e,function(e){var a=angular.extend(e,{Tags:[]});angular.forEach(e.attributes,function(e){var t=e.split("|");3!==t.length&&console.error("The attribute was not specified, this must be fixed.");var r={Name:t[0]||"none",Tag:t[1],Type:t[2]||"Many"};a.Tags.push(r)}),t.push(a)}),t}}};e.factory("filterService",t)}(angular.module("filterPageApp")),function(e){var t=function(e,t,a,r,n,i,l){var c=this;c.activeFilters=[],c.allCardData={},c.isEverythingFilteredOut=!1,c.setFilter=function(e,t){g(e,t),o(),s()},c.clearFilters=function(){c.activeFilters=[],o(),s()};var o=function(){var e=document.getElementById("results-display");n.addClass(e,"fade-out"),c.items=c.allCardData.filter(p),angular.element(e).trigger("bcpl.filter.changed",{items:c.items}),bcpl.utility.windowShade.cycle(250,2e3),i(function(){n.removeClass(e,"fade-out")},250)},u="function"==typeof Event?new t.Event("bc-filter-cards-loaded"):void 0,s=function(){u?document.dispatchEvent(u):angular.element(document).trigger("bc-filter-cards-loaded")},f=function(t){if(t.length){var a=Object.prototype.hasOwnProperty.call(t[0],"Tags")?t:r.transformAttributesToTags(t);c.filters=r.build(a),c.allCardData=a,c.items=a,angular.element("#results-display").trigger("bcpl.filter.changed",{items:c.items}),s(),e.$apply()}},p=function(e){var t=0;if(!e)return!1;var a=_.pluck(e.Tags,"Tag");return angular.forEach(c.activeFilters,function(e){-1!==a.indexOf(e)&&(t+=1)}),t===c.activeFilters.length},g=function(e,t){var a=Object.prototype.hasOwnProperty.call(e,"Tag"),r=a?e.Tag:e,n=c.activeFilters.indexOf(r),i=-1===n,o=t;a&&(o=_.where(c.filters,{name:e.Name}),1===o.length&&(o=o[0]));var u=!!o.type&&o.type.toLowerCase()===l.filters.tags.types.pickOne,s=[];i&&u&&angular.forEach(o.tags,function(e){e!==r&&s.push(e)}),angular.forEach(s,function(e){-1!==c.activeFilters.indexOf(e)&&c.activeFilters.splice(c.activeFilters.indexOf(e),1)}),i?c.activeFilters.push(r):c.activeFilters.splice(n,1)},d=function(e){angular.element(e.currentTarget).closest(".expando-wrapper").find("i").toggleClass("fa-plus-square").toggleClass("fa-minus-square")};angular.element(document).on("hide.bs.collapse",".expando-wrapper .collapse",d),angular.element(document).on("show.bs.collapse",".expando-wrapper .collapse",d),a.get(f)};t.$inject=["$scope","$window","cardService","filterService","$animate","$timeout","CONSTANTS"],e.controller("FilterPageCtrl",t)}(angular.module("filterPageApp")),function(e){var t=function(e,t,a,r){return{restrict:"E",scope:{filterHandler:"=",cardData:"=",activeFilters:"=",template:"="},template:"",link:function(t,n,i){a(r.templates[i.template]).then(function(a){n.append(e(a)(t))})}}};t.$inject=["$compile","$injector","$templateRequest","CONSTANTS"],e.directive("card",t)}(angular.module("filterPageApp")),function(e){var t=function(){return{scope:{tag:"=",activeFilters:"=",filterHandler:"=",filterFamily:"="},restrict:"E",templateUrl:"/js/apps/filter-page/templates/filter.html",link:function(e,t){var a=angular.element(t),r=a.find("input"),n="many"===e.filterFamily.type.trim().toLowerCase()?"checkbox":"radio";r.prop("type",n),"radio"===n&&r.prop("name",e.filterFamily.name),e.toggleFilter=function(t){e.isFilterChecked=a.has(":checked").length>0,e.filterHandler(t,e.filterFamily)}}}};e.directive("filter",t)}(angular.module("filterPageApp")),function(e){var t=function(){return{scope:{familyNameOverride:"@",isInitiallyExpanded:"@",filterHandler:"=",filterData:"=",activeFilters:"=",clearFilterFn:"="},restrict:"E",templateUrl:"/js/apps/filter-page/templates/filters.html",link:function(e){var t=function(e,t){return e.toLowerCase()===t.toLowerCase()};e.$watch("filterData",function(){e.filterFamilies=e.filterData?e.filterData.map(a):e.filterFamilies,e.filterFamilies&&e.filterFamilies.length&&e.filterFamilies.forEach(function(a){var r=a&&Object.hasOwnProperty.call(a,"tags")&&a.tags.length,n=r?a.tags:[],i=!1;e.activeFilters.forEach(function(e){i||(i=!!n.filter(function(a){return t(a,e)}).length)}),a.isFilterActive=i})});var a=function(t){var a=t;return a.name="none"===a.name?e.familyNameOverride:a.name,a&&(a.filterId=a.name.replace(/[^\w]/g,"-")),a}}}};e.directive("filters",t)}(angular.module("filterPageApp")),function(e){var t=function(){return{scope:{filterHandler:"=",tagData:"=",activeFilters:"="},restrict:"E",templateUrl:"/js/apps/filter-page/templates/tag.html",link:function(e){e.toggleFilter=function(t){var a=e.tagData.Tags.filter(function(e){return e.Tag===t.Tag});a.length&&e.filterHandler(t,a[0])}}}};e.directive("tag",t)}(angular.module("filterPageApp"));