"use strict";!function(){var e=angular.module("sharedServices",["sharedConstants"]),t=function(e,t,r){var n=function(){var n=e.defer();return t.get(r.urls.getBranches).then(function(e){return a(e,n)}).catch(function(e){return i(e,n)})},a=function(e,t){var r=e?e.data:"There was a problem getting data, please try again later.";return t.resolve(r),t.promise},i=function(e,t){return t.reject(e),t.promise};return{getBranchesById:function(e){return n().then(function(t){return t.filter(function(t){return e.includes(t.id)})})},getBranchesByName:function(e){return n().then(function(t){return t.filter(function(t){return e.map(function(e){return e.toLowerCase()}).includes(t.name.toLowerCase())})})}}};e.factory("sharedServices.branchesService",["$q","$http","sharedConstants.CONSTANTS",t])}(),function(){var e=angular.module("sharedConstants",[]),t={urls:{getBranches:"data/branch-amenities.json"}};e.constant("sharedConstants.CONSTANTS",t)}(),function(){var e=angular.module("sharedFilters",[]),t=function(e){var t=function(t){e.search({})},r=function(e,t){return!!t&&!!Object.keys(e).filter(function(e){return e.toLowerCase()===t.toLowerCase()}).length},n=function(e){return e?e&&e.indexOf(",")>-1?e.split(","):[e]:[]},a=function(){return e.search()},i=function(e,t){return Object.hasOwnProperty.call(e,t)?n(e[t]):[]},l=function(t,r){if(t){var n=e.search();n[t]=r,e.search(n)}};return{clearQueryParams:t,doesKeyExist:r,getFiltersFromString:n,getQueryParamValuesByKey:i,setQueryParams:l,updateQueryParams:function(e,n){var o=a();if(r(o,e)){var c=i(o,e),u=c.includes(n),s=[];if(u){var f=c.indexOf(n);c.splice(f,1)}else c.push(n);s=c,s.length?l(e,s.join(",")):t()}else l(e,n)}}};e.factory("sharedFilters.filterHelperService",["$location",t])}(),function(){angular.module("filterPageApp",["ngAnimate"]).config(function(e){e.html5Mode({enabled:!0,requireBase:!1})})}(),function(e){var t={templates:{databases:"/js/apps/filter-page/templates/card-databases.html",locations:"/js/apps/filter-page/templates/card-locations.html"},urls:{databases:"https://testservices.bcpl.info/api/structured-content/databases",locations:"/sebin/q/r/branch-amenities.json"},filters:{tags:{types:{pickOne:"one",pickMany:"many"}}}};e.constant("CONSTANTS",t)}(angular.module("filterPageApp")),function(e){var t=function(){return function(e,t){var r=[];return angular.forEach(e,function(e){var n=0;angular.forEach(e.Tags,function(e){-1!==t.indexOf(e.Tag)&&(n+=1)}),n===t.length&&r.push(e)}),r}};t.$inject=[],e.filter("cardVisibilityFilter",t)}(angular.module("filterPageApp")),function(e){var t=function(e){return{get:function(t,r){$.ajax(e.urls.databases).done(t).fail(r)}}};t.$inject=["CONSTANTS"],e.factory("databasesService",t)}(angular.module("filterPageApp")),function(e){var t=function(e){var t=function(e,t){t("string"==typeof e?JSON.parse(e):e)};return{get:function(r,n){$.ajax(e.urls.locations).done(function(e){t(e,r)}).fail(n)}}};t.$inject=["CONSTANTS"],e.factory("locationsService",t)}(angular.module("filterPageApp")),function(e){var t=function(e,t,r){var n=function(e){var t=e.split("/");return t[t.length-1].split(".")[0]};return{get:function(e){var a=n(t.location.pathname);r.get(a+"Service").get(function(t){var r=_.sortBy(t,function(e){return e.Title});e(r)})}}};t.$inject=["$location","$window","$injector"],e.factory("cardService",t)}(angular.module("filterPageApp")),function(e){var t=function(){var e=function(e){var t=[];return angular.forEach(e,function(e){t=t.concat(e.Tags)}),t},t=function(e){return _.uniq(_.pluck(e,"Name"),function(e){return e})},r=function(e,t){var r=_.where(t,{Name:e});return _.uniq(_.sortBy(_.pluck(r,"Tag"),function(e){return e}),function(e){return e})},n=function(e,t){var r=_.findWhere(t,{Name:e});return r?r.Type:"none"};return{build:function(a){var i=[],l=e(a),o=t(l);return angular.forEach(o,function(e){i.push({name:e,tags:r(e,l),type:n(e,l)})}),i},transformAttributesToTags:function(e){var t=[];return angular.forEach(e,function(e){var r=angular.extend(e,{Tags:[]});angular.forEach(e.attributes,function(e){var t=e.split("|");3!==t.length&&console.error("The attribute was not specified, this must be fixed.");var n={Name:t[0]||"none",Tag:t[1],Type:t[2]||"Many"};r.Tags.push(n)}),t.push(r)}),t}}};e.factory("filterService",t)}(angular.module("filterPageApp"));var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var t=function(e,t,r,n,a,i,l){var o=this;o.activeFilters=[],o.allCardData={},o.isEverythingFilteredOut=!1,o.setFilter=function(e,t){h(e,t),g(e,t),d()},o.clearFilters=function(){o.activeFilters=[],u(),d()};var c=function(e,t){var r=Object.hasOwnProperty.call(e,"val")&&e.val;if(!!r&&e.val.toLowerCase().indexOf(t.toLowerCase())>-1){if(!(r&&e.val.indexOf(",")>-1))return null;var n=T(e.val),a=[];return n.forEach(function(e){e.toLowerCase()!==t.toLowerCase()&&a.push(e)}),a.join(",")}return e.val?e.val+","+t:t||null},u=function(){return e.search({})},s=function(e){return e&&Object.hasOwnProperty.call(e,"Tag")?e.Tag:e||null},f=function(e,t){var r=e&&"object"===(void 0===e?"undefined":_typeof(e)),n=r&&Object.hasOwnProperty.call(e,"filterId")?e.filterId:r&&Object.hasOwnProperty.call(e,"Name")?e.Name:e||null;return{key:n,val:p(t,n)}},p=function(e,t){return e&&"object"===(void 0===e?"undefined":_typeof(e))?e[t]||null:null},g=function(t,r){var n=s(t);if(n){var a=e.search(),i=f(r,a),l=c(i,n);e.search(i.key,l)}},d=function(){var e=document.getElementById("results-display");a.addClass(e,"fade-out"),o.allCardData&&o.allCardData.length&&(o.items=o.allCardData.filter(v)),angular.element(e).trigger("bcpl.filter.changed",{items:o.items}),bcpl.utility.windowShade.cycle(250,2e3),i(function(){a.removeClass(e,"fade-out")},250)},m=function(e,r){if(e.length){var a=Object.prototype.hasOwnProperty.call(e[0],"Tags")?e:n.transformAttributesToTags(e);o.filters=n.build(a),o.allCardData=a,o.items=a,angular.element("#results-display").trigger("bcpl.filter.changed",{items:o.items}),t.$apply(),r&&"function"==typeof r&&r()}},v=function(e){var t=0;if(!e)return!1;var r=_.pluck(e.Tags,"Tag");return angular.forEach(o.activeFilters,function(e){-1!==r.indexOf(e)&&(t+=1)}),t===o.activeFilters.length},h=function(e,t){var r=Object.prototype.hasOwnProperty.call(e,"Tag"),n=r?e.Tag:e,a=o.activeFilters.indexOf(n),i=-1===a,c=t;r&&(c=_.where(o.filters,{name:e.Name}),1===c.length&&(c=c[0]));var u=!!c.type&&c.type.toLowerCase()===l.filters.tags.types.pickOne,s=[];i&&u&&angular.forEach(c.tags,function(e){e!==n&&s.push(e)}),angular.forEach(s,function(e){-1!==o.activeFilters.indexOf(e)&&o.activeFilters.splice(o.activeFilters.indexOf(e),1)}),i?o.activeFilters.push(n):o.activeFilters.splice(a,1)},y=function(e){angular.element(e.currentTarget).closest(".expando-wrapper").find("i").toggleClass("fa-plus-square").toggleClass("fa-minus-square")};angular.element(document).on("hide.bs.collapse",".expando-wrapper .collapse",y),angular.element(document).on("show.bs.collapse",".expando-wrapper .collapse",y);var b=function(e){return e?e.replace(/-/g," "):""},O=function(e){var t=b(e),r=o.filters.filter(function(e){return t.toLowerCase()===e.name.toLowerCase()});return r.length?r[0]:null},T=function(e){return e?e&&e.indexOf(",")>-1?e.split(","):[e]:[]},F=function(){setTimeout(function(){var e={items:t.filteredItems};angular.element("#results-display").trigger("bcpl.filter.changed",e)},250)},C=function(){var t=e.search();Object.keys(t).length?(Object.keys(t).forEach(function(e){var r=t[e],n=T(r),a=O(e);o.activeFilters=[],n.forEach(function(e){h(e,a)})}),F()):o.clearFilters()};t.$on("$locationChangeSuccess",function(){C(),d()}),function(){r.get(function(e){m(e,C)})}()};t.$inject=["$location","$scope","cardService","filterService","$animate","$timeout","CONSTANTS"],e.controller("FilterPageCtrl",t)}(angular.module("filterPageApp")),function(e){var t=function(e,t,r,n){return{restrict:"E",scope:{filterHandler:"=",cardData:"=",activeFilters:"=",template:"="},template:"",link:function(t,a,i){r(n.templates[i.template]).then(function(r){a.append(e(r)(t))})}}};t.$inject=["$compile","$injector","$templateRequest","CONSTANTS"],e.directive("card",t)}(angular.module("filterPageApp")),function(e){var t=function(){return{scope:{tag:"=",activeFilters:"=",filterHandler:"=",filterFamily:"="},restrict:"E",templateUrl:"/js/apps/filter-page/templates/filter.html",link:function(e,t){var r=angular.element(t),n=r.find("input"),a="many"===e.filterFamily.type.trim().toLowerCase()?"checkbox":"radio";n.prop("type",a),"radio"===a&&n.prop("name",e.filterFamily.name),e.toggleFilter=function(t){e.isFilterChecked=r.has(":checked").length>0,e.filterHandler(t,e.filterFamily)}}}};e.directive("filter",t)}(angular.module("filterPageApp")),function(e){var t=function(){return{scope:{familyNameOverride:"@",isInitiallyExpanded:"@",filterHandler:"=",filterData:"=",activeFilters:"=",clearFilterFn:"="},restrict:"E",templateUrl:"/js/apps/filter-page/templates/filters.html",link:function(e){var t=function(e,t){return e.toLowerCase()===t.toLowerCase()};e.$watch("filterData",function(){e.filterFamilies=e.filterData?e.filterData.map(r):e.filterFamilies,e.filterFamilies&&e.filterFamilies.length&&e.filterFamilies.forEach(function(r){var n=r&&Object.hasOwnProperty.call(r,"tags")&&r.tags.length,a=n?r.tags:[],i=!1;e.activeFilters.forEach(function(e){i||(i=!!a.filter(function(r){return t(r,e)}).length)}),r.isFilterActive=i})});var r=function(t){var r=t;return r.name="none"===r.name?e.familyNameOverride:r.name,r&&(r.filterId=r.name.replace(/[^\w]/g,"-")),r}}}};e.directive("filters",t)}(angular.module("filterPageApp")),function(e){var t=function(){return{scope:{filterHandler:"=",tagData:"=",activeFilters:"="},restrict:"E",templateUrl:"/js/apps/filter-page/templates/tag.html",link:function(e){e.toggleFilter=function(t){var r=e.tagData.Tags.filter(function(e){return e.Tag===t.Tag});r.length&&e.filterHandler(t,r[0])}}}};e.directive("tag",t)}(angular.module("filterPageApp"));