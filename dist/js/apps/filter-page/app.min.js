"use strict";!function(){var e=angular.module("sharedFilters",[]),t=function(e){var t=function(e,t){var a=Object.assign({},t);return e&&delete a[e],a},a=function(a){if(!a)return void e.search({});var n=Object.assign({},e.search());a.forEach(function(e){n=t(e,n)}),e.search(n)},n=function(e,t){return!!t&&!!Object.keys(e).filter(function(e){return e.toLowerCase()===t.toLowerCase()}).length},r=function(e,t){return e?e.indexOf(",")>-1?t?e:e.split(","):[e]:[]},i=function(){return e.search()},l=function(e,t,a){return Object.hasOwnProperty.call(e,t)?r(e[t],a):a?"":[]},c=function(t){t.forEach(function(t){var a=t.key,n=t.val;if(a){var r=e.search();r[a]=n,e.search(r)}})};return{clearQueryParams:a,doesKeyExist:n,getFiltersFromString:r,getQueryParams:i,getQueryParamValuesByKey:l,setQueryParams:c,updateQueryParams:function(e){var t=i();e.forEach(function(e){var r=e.key,i=e.val;if(n(t,r)){var o=l(t,r),s=o.includes(i),u=[];if(s){var f=o.indexOf(i);o.splice(f,1)}else o.push(i);u=o,u.length?c([{key:r,val:u.join(",")}]):a([r])}else c([{key:r,val:i}])})}}};e.factory("sharedFilters.filterHelperService",["$location",t])}(),namespacer("bcpl"),bcpl.boostrapCollapseHelper=function(e){return{toggleCollapseByIds:function(t){var a=t.activePanels,n=t.inActivePanels;a.forEach(function(t){e("#"+t).collapse("show")}),n.forEach(function(t){e("#"+t).collapse("hide")})}}}(jQuery),function(){angular.module("filterPageApp",["ngAnimate","ngAria"]).config(function(e){e.html5Mode({enabled:!0,requireBase:!1})})}(),function(e){var t={templates:{databases:"/_js/apps/filter-page/templates/card-databases.html",locations:"/_js/apps/filter-page/templates/card-locations.html",filter:"/_js/apps/filter-page/templates/filter.html",filters:"/_js/apps/filter-page/templates/filters.html",tag:"/_js/apps/filter-page/templates/tag.html"},urls:{databases:"https://services.bcpl.info/api/structured-content/databases",locations:"/sebin/q/r/branch-amenities.json"},filters:{tags:{types:{pickOne:"one",pickMany:"many"}}},analytics:{bcplLocationsCategory:"BCPL Locations"}};e.constant("CONSTANTS",t)}(angular.module("filterPageApp")),function(e){var t=function(){return function(e,t){var a=[];return angular.forEach(e,function(e){var n=0;angular.forEach(e.Tags,function(e){-1!==t.indexOf(e.Tag)&&(n+=1)}),n===t.length&&a.push(e)}),a}};t.$inject=[],e.filter("cardVisibilityFilter",t)}(angular.module("filterPageApp")),function(e){var t=function(e){return{get:function(t,a){$.ajax(e.urls.databases).done(t).fail(a)}}};t.$inject=["CONSTANTS"],e.factory("databasesService",t)}(angular.module("filterPageApp")),function(e){var t=function(e){var t=function(e,t){t("string"==typeof e?JSON.parse(e):e)};return{get:function(a,n){$.ajax(e.urls.locations).done(function(e){t(e,a)}).fail(n)}}};t.$inject=["CONSTANTS"],e.factory("locationsService",t)}(angular.module("filterPageApp")),function(e){var t=function(e,t,a){return{get:function(e,t){a.get(t+"Service").get(function(t){var a=_.sortBy(t,function(e){return e.Title});e(a)})}}};t.$inject=["$location","$window","$injector"],e.factory("cardService",t)}(angular.module("filterPageApp")),function(e){var t=function(){var e=function(e){var t=[];return angular.forEach(e,function(e){t=t.concat(e.Tags)}),t},t=function(e){return _.uniq(_.pluck(e,"Name"),function(e){return e})},a=function(e,t){var a=_.where(t,{Name:e});return _.uniq(_.sortBy(_.pluck(a,"Tag"),function(e){return e}),function(e){return e})},n=function(e,t){var a=_.findWhere(t,{Name:e});return a?a.Type:"none"};return{build:function(r){var i=[],l=e(r),c=t(l);return angular.forEach(c,function(e){i.push({name:e,tags:a(e,l),type:n(e,l)})}),i},transformAttributesToTags:function(e){var t=[];return angular.forEach(e,function(e){var a=angular.extend(e,{Tags:[]});angular.forEach(e.attributes,function(e){var t=e.split("|");3!==t.length&&console.error("The attribute was not specified, this must be fixed.");var n={Name:t[0]||"none",Tag:t[1],Type:t[2]||"Many"};a.Tags.push(n)}),t.push(a)}),t}}};e.factory("filterService",t)}(angular.module("filterPageApp")),function(e,t){var a=t.trackEvent,n=function(e,t,n,r,i,l,c,o){var s=this;s.activeFilters=[],s.allCardData={},s.isEverythingFilteredOut=!1,s.setFilter=function(e,t){v(e,t),u(),p()},s.clearFilters=function(){s.activeFilters=[],u(),p(),a({action:"Clear All Filters",category:o.analytics.bcplLocationsCategory})},s.setFilterType=function(e){s.filterType=e};var u=function(){var e=document.getElementById("results-display");l.addClass(e,"fade-out"),s.items=s.allCardData.filter(d),angular.element(e).trigger("bcpl.filter.changed",{items:s.items}),bcpl.utility.windowShade.cycle(250,2e3),c(function(){l.removeClass(e,"fade-out")},250)},f=function(e){var t;"function"==typeof Event?t=new Event(e):(t=document.createEvent("Event"),t.initEvent(e,!0,!0)),document.dispatchEvent(t)},p=function(){f("bc-filter-cards-loaded")},g=function(t){if(t.length){var a=Object.prototype.hasOwnProperty.call(t[0],"Tags")?t:i.transformAttributesToTags(t);s.filters=i.build(a),s.allCardData=a,s.items=a,angular.element("#results-display").trigger("bcpl.filter.changed",{items:s.items}),e.$apply(function(){c(function(){p()},250)})}},d=function(e){var t=0;if(!e)return!1;var a=_.pluck(e.Tags,"Tag");return angular.forEach(s.activeFilters,function(e){-1!==a.indexOf(e)&&(t+=1)}),t===s.activeFilters.length},v=function(e,t){var a=Object.prototype.hasOwnProperty.call(e,"Tag"),n=a?e.Tag:e,r=s.activeFilters.indexOf(n),i=-1===r,l=t;a&&(l=_.where(s.filters,{name:e.Name}),1===l.length&&(l=l[0]));var c=!!l.type&&l.type.toLowerCase()===o.filters.tags.types.pickOne,u=[];i&&c&&angular.forEach(l.tags,function(e){e!==n&&u.push(e)}),angular.forEach(u,function(e){-1!==s.activeFilters.indexOf(e)&&s.activeFilters.splice(s.activeFilters.indexOf(e),1)}),i?s.activeFilters.push(n):s.activeFilters.splice(r,1)},m=function(e){angular.element(e.currentTarget).closest(".expando-wrapper").find("i").toggleClass("fa-plus-square").toggleClass("fa-minus-square")};angular.element(document).on("hide.bs.collapse",".expando-wrapper .collapse",m),angular.element(document).on("show.bs.collapse",".expando-wrapper .collapse",m),t.ready(function(){s.filterType&&"string"==typeof s.filterType&&r.get(g,s.filterType)})};n.$inject=["$scope","$document","$window","cardService","filterService","$animate","$timeout","CONSTANTS"],e.controller("FilterPageCtrl",n)}(angular.module("filterPageApp"),bcpl.utility.googleAnalytics),function(e,t){var a=t.trackEvent,n=function(e,t,n,r){return{restrict:"E",scope:{filterHandler:"=",cardData:"=",activeFilters:"=",template:"="},template:"",link:function(t,i,l){n(r.templates[l.template]).then(function(a){i.append(e(a)(t))});var c=function(e){e&&e.href&&(window.location=e.href)};t.track=function(e,t,n){n.preventDefault(),a({action:e,category:r.analytics.bcplLocationsCategory,label:t}),c(n.currentTarget)}}}};n.$inject=["$compile","$injector","$templateRequest","CONSTANTS"],e.directive("card",n)}(angular.module("filterPageApp"),bcpl.utility.googleAnalytics),function(e,t){var a=t.trackEvent,n=function(e){var t=function(t,n){var r=angular.element(n),i=r.find("input"),l="many"===t.filterFamily.type.trim().toLowerCase()?"checkbox":"radio";i.prop("type",l),"radio"===l&&i.prop("name",t.filterFamily.name),t.toggleFilter=function(n){t.isFilterChecked=r.has(":checked").length>0,t.filterHandler(n,t.filterFamily),a({action:"Filter Selection",category:e.analytics.bcplLocationsCategory,label:n+" = "+(t.isFilterChecked?"Selected":"Unselected")})}};return{scope:{tag:"=",activeFilters:"=",filterHandler:"=",filterFamily:"="},restrict:"E",templateUrl:e.templates.filter,link:t}};n.$inject=["CONSTANTS"],e.directive("filter",n)}(angular.module("filterPageApp"),bcpl.utility.googleAnalytics),function(e){var t=function(e){var t=function(e){var t=function(e,t){return e.toLowerCase()===t.toLowerCase()};e.$watch("filterData",function(){e.filterFamilies=e.filterData?e.filterData.map(a):e.filterFamilies,e.filterFamilies&&e.filterFamilies.length&&e.filterFamilies.forEach(function(a){if(a){var n=Object.hasOwnProperty.call(a,"tags")&&a.tags.length,r=n?a.tags:[],i=!1;e.activeFilters.forEach(function(e){i||(i=!!r.filter(function(a){return t(a,e)}).length)}),a.isFilterActive=i}})});var a=function(t){var a=t;return a&&(a.name="none"===a.name?e.familyNameOverride:a.name,a.filterId=a.name.replace(/[^\w]/g,"-")),a}};return{scope:{familyNameOverride:"@",isInitiallyExpanded:"@",filterHandler:"=",filterData:"=",activeFilters:"=",clearFilterFn:"="},restrict:"E",templateUrl:e.templates.filters,link:t}};t.$inject=["CONSTANTS"],e.directive("filters",t)}(angular.module("filterPageApp")),function(e,t){var a=t.trackEvent,n=function(e){var t=function(t){t.toggleFilter=function(n){var r=!t.activeFilters.includes(n.Tag),i=t.tagData.Tags.filter(function(e){return e.Tag===n.Tag});i.length&&t.filterHandler(n,i[0]),a({action:"Filter Tag Selection",category:e.analytics.bcplLocationsCategory,label:t.tagData.name+" "+n.Tag+" = "+(r?"Selected":"Unselected")})}};return{scope:{filterHandler:"=",tagData:"=",activeFilters:"="},restrict:"E",templateUrl:e.templates.tag,link:t}};n.$inject=["CONSTANTS"],e.directive("tag",n)}(angular.module("filterPageApp"),bcpl.utility.googleAnalytics);