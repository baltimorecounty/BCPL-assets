"use strict";!function(){angular.module("filterPageApp",["ngAnimate"])}(),function(t){var e={templates:{databases:"/js/apps/filter-page/templates/card-databases.html",locations:"/js/apps/filter-page/templates/card-locations.html"},urls:{databases:"http://testservices.bcpl.info/api/structured-content/databases",locations:"/sebin/q/r/branch-amenities.json"},filters:{tags:{types:{pickOne:"one",pickMany:"many"}}}};t.constant("CONSTANTS",e)}(angular.module("filterPageApp")),function(t){var e=function(){return function(t,e){var a=[];return angular.forEach(t,function(t){var r=0;angular.forEach(t.Tags,function(t){-1!==e.indexOf(t.Tag)&&(r+=1)}),r===e.length&&a.push(t)}),a}};e.$inject=[],t.filter("cardVisibilityFilter",e)}(angular.module("filterPageApp")),function(t){var e=function(t){return{get:function(e,a){$.ajax(t.urls.databases).done(e).fail(a)}}};e.$inject=["CONSTANTS"],t.factory("databasesService",e)}(angular.module("filterPageApp")),function(t){var e=function(t){var e=function(t,e){e("string"==typeof t?JSON.parse(t):t)};return{get:function(a,r){$.ajax(t.urls.locations).done(function(t){e(t,a)}).fail(r)}}};e.$inject=["CONSTANTS"],t.factory("locationsService",e)}(angular.module("filterPageApp")),function(t){var e=function(t,e,a){var r=function(t){var e=t.split("/");return e[e.length-1].split(".")[0]};return{get:function(t){var n=r(e.location.pathname);a.get(n+"Service").get(function(e){var a=_.sortBy(e,function(t){return t.Title});t(a)})}}};e.$inject=["$location","$window","$injector"],t.factory("cardService",e)}(angular.module("filterPageApp")),function(t){var e=function(){var t=function(t){var e=[];return angular.forEach(t,function(t){e=e.concat(t.Tags)}),e},e=function(t){return _.uniq(_.pluck(t,"Name"),function(t){return t})},a=function(t,e){var a=_.where(e,{Name:t});return _.uniq(_.sortBy(_.pluck(a,"Tag"),function(t){return t}),function(t){return t})},r=function(t,e){var a=_.findWhere(e,{Name:t});return a?a.Type:"none"};return{build:function(n){var i=[],l=t(n),c=e(l);return angular.forEach(c,function(t){i.push({name:t,tags:a(t,l),type:r(t,l)})}),i},transformAttributesToTags:function(t){var e=[];return angular.forEach(t,function(t){var a=angular.extend(t,{Tags:[]});angular.forEach(t.attributes,function(t){var e={Name:"none",Tag:t,Type:"Many"};a.Tags.push(e)}),e.push(a)}),e}}};t.factory("filterService",e)}(angular.module("filterPageApp")),function(t){var e=function(t,e,a,r,n,i){var l=this;l.activeFilters=[],l.allCardData={},l.isEverythingFilteredOut=!1,l.setFilter=function(t,e){f(t,e),c()},l.clearFilters=function(){l.activeFilters=[],c()};var c=function(){var t=angular.element("#results-display");r.addClass(t,"fade-out"),l.items=l.allCardData.filter(o),t.trigger("bcpl.filter.changed",{items:l.items}),bcpl.utility.windowShade.cycle(250,2e3),n(function(){r.removeClass(t,"fade-out")},250)},u=function(e){if(e.length){var r=Object.prototype.hasOwnProperty.call(e[0],"Tags")?e:a.transformAttributesToTags(e);l.filters=a.build(r),l.allCardData=r,l.items=r,angular.element("#results-display").trigger("bcpl.filter.changed",{items:l.items}),t.$apply()}},o=function(t){var e=0;if(!t)return!1;var a=_.pluck(t.Tags,"Tag");return angular.forEach(l.activeFilters,function(t){-1!==a.indexOf(t)&&(e+=1)}),e===l.activeFilters.length},f=function(t,e){var a=Object.prototype.hasOwnProperty.call(t,"Tag"),r=a?t.Tag:t,n=l.activeFilters.indexOf(r),c=-1===n,u=e;a&&(u=_.where(l.filters,{name:t.Name}),1===u.length&&(u=u[0]));var o=u.type.toLowerCase()===i.filters.tags.types.pickOne,f=[];c&&o&&angular.forEach(u.tags,function(t){t!==r&&f.push(t)}),angular.forEach(f,function(t){-1!==l.activeFilters.indexOf(t)&&l.activeFilters.splice(l.activeFilters.indexOf(t),1)}),c?l.activeFilters.push(r):l.activeFilters.splice(n,1)};e.get(u)};e.$inject=["$scope","cardService","filterService","$animate","$timeout","CONSTANTS"],t.controller("FilterPageCtrl",e)}(angular.module("filterPageApp")),function(t){var e=function(t,e,a,r){return{restrict:"E",scope:{filterHandler:"=",cardData:"=",activeFilters:"=",template:"="},template:"",link:function(e,n,i){a(r.templates[i.template]).then(function(a){n.append(t(a)(e))})}}};e.$inject=["$compile","$injector","$templateRequest","CONSTANTS"],t.directive("card",e)}(angular.module("filterPageApp")),function(t){var e=function(){return{scope:{tag:"=",activeFilters:"=",filterHandler:"=",filterFamily:"="},restrict:"E",templateUrl:"/js/apps/filter-page/templates/filter.html",link:function(t,e){var a=angular.element(e),r=a.find("input"),n="many"===t.filterFamily.type.trim().toLowerCase()?"checkbox":"radio";r.prop("type",n),"radio"===n&&r.prop("name",t.filterFamily.name),t.toggleFilter=function(e){t.isFilterChecked=a.has(":checked").length>0,t.filterHandler(e,t.filterFamily)}}}};t.directive("filter",e)}(angular.module("filterPageApp")),function(t){var e=function(){return{scope:{filterHandler:"=",filterData:"=",activeFilters:"=",clearFilterFn:"="},restrict:"E",templateUrl:"/js/apps/filter-page/templates/filters.html",link:function(t){t.$watch("filterData",function(){t.filterFamilies=t.filterData})}}};t.directive("filters",e)}(angular.module("filterPageApp")),function(t){var e=function(){return{scope:{filterHandler:"=",tagData:"=",activeFilters:"="},restrict:"E",templateUrl:"/js/apps/filter-page/templates/tag.html",link:function(t){t.toggleFilter=function(e){var a=t.tagData.Tags.filter(function(t){return t.Tag===e.Tag});a.length&&t.filterHandler(e,a[0])}}}};t.directive("tag",e)}(angular.module("filterPageApp"));